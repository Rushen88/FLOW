# -*- coding: utf-8 -*-
"""
Скрипт генерации исправленного ТЗ для FlowerBoss (FLOW)
"""
from docx import Document
from docx.shared import Pt, Inches, Cm, RGBColor
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.enum.table import WD_TABLE_ALIGNMENT
from docx.oxml.ns import qn
import os

doc = Document()

# ---- Стили ----
style = doc.styles['Normal']
font = style.font
font.name = 'Calibri'
font.size = Pt(11)

# Настройка полей
for section in doc.sections:
    section.top_margin = Cm(2)
    section.bottom_margin = Cm(2)
    section.left_margin = Cm(2.5)
    section.right_margin = Cm(2)

def add_heading(text, level=1):
    h = doc.add_heading(text, level=level)
    return h

def add_para(text, bold=False, italic=False, size=None, color=None, align=None, space_after=Pt(6)):
    p = doc.add_paragraph()
    run = p.add_run(text)
    run.bold = bold
    run.italic = italic
    if size:
        run.font.size = size
    if color:
        run.font.color.rgb = color
    if align:
        p.alignment = align
    p.paragraph_format.space_after = space_after
    return p

def add_bullet(text, level=0):
    p = doc.add_paragraph(text, style='List Bullet')
    if level > 0:
        p.paragraph_format.left_indent = Cm(1.27 * (level + 1))
    return p

def add_bullet2(text):
    return add_bullet(text, level=1)

def add_table_simple(headers, rows):
    table = doc.add_table(rows=1 + len(rows), cols=len(headers))
    table.style = 'Light Grid Accent 1'
    table.alignment = WD_TABLE_ALIGNMENT.LEFT
    # Header
    for i, h in enumerate(headers):
        cell = table.rows[0].cells[i]
        cell.text = h
        for paragraph in cell.paragraphs:
            for run in paragraph.runs:
                run.bold = True
                run.font.size = Pt(10)
    # Rows
    for r_idx, row in enumerate(rows):
        for c_idx, val in enumerate(row):
            cell = table.rows[r_idx + 1].cells[c_idx]
            cell.text = str(val)
            for paragraph in cell.paragraphs:
                for run in paragraph.runs:
                    run.font.size = Pt(10)
    return table

# ============================================================
# ТИТУЛЬНАЯ СТРАНИЦА
# ============================================================
doc.add_paragraph()
doc.add_paragraph()
add_para('ТЕХНИЧЕСКОЕ ЗАДАНИЕ', bold=True, size=Pt(28), align=WD_ALIGN_PARAGRAPH.CENTER, space_after=Pt(12))
add_para('Система управления цветочным бизнесом', bold=True, size=Pt(18), align=WD_ALIGN_PARAGRAPH.CENTER, space_after=Pt(6))
add_para('«FlowerBoss»', bold=True, size=Pt(22), align=WD_ALIGN_PARAGRAPH.CENTER, space_after=Pt(24))
add_para('Версия 2.0 — исправленная и дополненная', italic=True, size=Pt(14), align=WD_ALIGN_PARAGRAPH.CENTER, space_after=Pt(48))
add_para('Целевая аудитория: индивидуальные цветочные магазины, небольшие и локальные сети (до 15–20 точек)', size=Pt(12), align=WD_ALIGN_PARAGRAPH.CENTER, space_after=Pt(6))
add_para('SaaS-решение • Подписочная модель • Облачное хранение', size=Pt(12), align=WD_ALIGN_PARAGRAPH.CENTER)
doc.add_page_break()

# ============================================================
# ОГЛАВЛЕНИЕ
# ============================================================
add_heading('ОГЛАВЛЕНИЕ', level=1)
toc_items = [
    '1. Инструменты и технический стек',
    '2. Общее описание системы',
    '3. Структура интерфейса (боковое меню)',
    '4. Модуль «Номенклатура»',
    '5. Модуль «Склад»',
    '6. Модуль «Продажи и заказы»',
    '7. Модуль «Клиенты»',
    '8. Модуль «Поставщики»',
    '9. Модуль «Персонал»',
    '10. Модуль «Финансы и кошельки»',
    '11. Модуль «Аналитика»',
    '12. Модуль «Маркетинг»',
    '13. Модуль «Доставка»',
    '14. Модуль «Настройки»',
    '15. Модуль «Уведомления»',
    '16. Взаимосвязи между модулями',
    '17. Роли и права доступа',
    '18. Автоматизация',
    '19. Дополнительные возможности',
    '20. Программа лояльности',
    '21. Технические требования',
]
for item in toc_items:
    doc.add_paragraph(item)
doc.add_page_break()

# ============================================================
# 1. ИНСТРУМЕНТЫ И ТЕХНИЧЕСКИЙ СТЕК
# ============================================================
add_heading('1. Инструменты и технический стек', level=1)

add_heading('1.1. Бэкенд', level=2)
add_bullet('Django + Django REST Framework')
add_bullet('Фоновые задачи: Celery + Redis')
add_bullet('Планировщик: Celery Beat')
add_bullet('WebSocket / real-time (обновление заказов, уведомлений): Django Channels')

add_heading('1.2. Фронтенд', level=2)
add_bullet('React + TypeScript')
add_bullet('Компонентная библиотека: MUI')
add_bullet('Таблицы: TanStack Table')
add_bullet('Формы: React Hook Form + Zod')
add_bullet('PWA-обёртка для мобильных устройств (Progressive Web App)')

add_heading('1.3. Хранилища и инфраструктура', level=2)
add_bullet('Основная БД: PostgreSQL')
add_bullet('Кэш / локи / очередь: Redis')
add_bullet('Файловое хранилище (фото): S3-совместимое (MinIO self-host или Yandex Object Storage)')
add_bullet('CDN для выдачи фото')
add_bullet('Полнотекстовый поиск: Meilisearch')
add_bullet('Брокер сообщений (на будущее): RabbitMQ')

add_heading('1.4. Аутентификация ​/ авторизация', level=2)
add_bullet('JWT (access + refresh) с ротацией refresh-токена')
add_bullet('2FA (TOTP) — обязательно для ролей «Владелец» и «Администратор»')
add_bullet('RBAC (Role-Based Access Control) + гранулярные ограничения на критичные операции')
add_bullet('Сессионные ограничения: автоматический выход при неактивности (настраиваемый тайм-аут)')

add_heading('1.5. Платежи ​/ тарификация (SaaS)', level=2)
add_bullet('ЮKassa / CloudPayments / Тинькофф (эквайринг, подписки)')
add_bullet('Тарифные планы с лимитами: количество сотрудников, торговых точек, складов, заказов, объём фото')
add_bullet('Биллинг-события: «оплата прошла», «подписка истекает», «grace period», «заморозка аккаунта»')
add_bullet('Trial-период: 14 дней бесплатного пользования со всеми функциями')

add_heading('1.6. DevOps', level=2)
add_bullet('Контейнеризация: Docker')
add_bullet('Оркестрация: Docker Compose + Nginx / Traefik')
add_bullet('CI/CD: GitHub Actions')
add_bullet('Наблюдаемость: Sentry (ошибки), Prometheus + Grafana (метрики), Loki (логи)')
add_bullet('Бэкапы PostgreSQL: ежедневные full + PITR (WAL), регулярные тесты восстановления')

add_heading('1.7. Интеграция с 1С (перспектива)', level=2)
add_bullet('Архитектурная шина событий: sale_posted, purchase_posted, inventory_adjusted, salary_accrued')
add_bullet('Экспорт/импорт: CSV / Excel (MVP), REST / HTTP-сервисы 1С (позднее)')
add_bullet('Идемпотентность — повторная выгрузка не дублирует документы')

doc.add_page_break()

# ============================================================
# 2. ОБЩЕЕ ОПИСАНИЕ СИСТЕМЫ
# ============================================================
add_heading('2. Общее описание системы', level=1)

add_para('FlowerBoss — облачная SaaS-система управления цветочным бизнесом, ориентированная на индивидуальные цветочные магазины, небольшие лавки и локальные сети (до 15–20 торговых точек). Система охватывает полный цикл операций: от закупки цветов и материалов до аналитики рентабельности и оценки эффективности рекламных каналов.')

add_heading('Ключевые принципы', level=2)

add_para('Партионный учёт', bold=True)
add_para('Каждая поступившая партия товара учитывается отдельно с фиксацией цены закупа, даты поступления и поставщика. При списании (продажа, комплектация, брак) система автоматически применяет метод FIFO (First In — First Out): первым списывается товар из самой старой партии.')

add_para('Автоматический расчёт себестоимости', bold=True)
add_para('При любой расходной операции (продажа, комплектация букета, списание) система рассчитывает себестоимость на основе реально списанных партий, обеспечивая точный расчёт прибыли по каждой позиции.')

add_para('Единая база данных', bold=True)
add_para('Все модули работают с единым хранилищем, обеспечивая мгновенное обновление информации во всех разделах.')

add_para('Многокошельковая финансовая модель', bold=True)
add_para('Денежные средства учитываются в нескольких «кошельках» (касса, расчётный счёт, дебетовая карта, накопительная касса, личные кошельки сотрудников). Отдельные кошельки могут допускать отрицательный баланс (настраивается).')

add_para('Умные уведомления', bold=True)
add_para('Система самостоятельно отслеживает критические события (низкие остатки, истекающие сроки свежести, знаменательные даты клиентов, кассовые разрывы) и информирует нужных сотрудников.')

add_para('Мультиточечность', bold=True)
add_para('Поддержка нескольких торговых точек с возможностью перемещения товара между ними и раздельной аналитикой.')

doc.add_page_break()

# ============================================================
# 3. СТРУКТУРА ИНТЕРФЕЙСА
# ============================================================
add_heading('3. Структура интерфейса (боковое меню)', level=1)

menu_text = """Главное меню отображается в виде боковой панели, которая доступна из любого раздела системы. Состав меню зависит от роли пользователя — каждый видит только те разделы, к которым имеет доступ."""
add_para(menu_text)

menu_items = [
    ('ГЛАВНАЯ ПАНЕЛЬ', ['Дашборд (сводка по бизнесу)']),
    ('СКЛАД', ['Остатки на складах', 'Приход товара', 'Комплектация букетов', 'Раскомплектация', 'Списание товара', 'Инвентаризация', 'Перемещение между складами', 'Резервы', 'История движения товара']),
    ('ПРОДАЖИ И ЗАКАЗЫ', ['Быстрая продажа', 'Оформление заказа / предзаказа', 'Список заказов', 'Возвраты', 'История продаж', 'Статистика продаж']),
    ('КЛИЕНТЫ', ['База клиентов', 'Знаменательные даты', 'Корпоративные клиенты', 'Программа лояльности', 'Должники (дебиторы)']),
    ('ПОСТАВЩИКИ', ['База поставщиков', 'Номенклатура поставщиков', 'История закупок', 'Задолженность (кредиторы)', 'Брак и претензии']),
    ('НОМЕНКЛАТУРА', ['Цветы', 'Расходные материалы', 'Декоративные материалы', 'Сопутствующие товары', 'Шаблоны букетов', 'Архив номенклатуры']),
    ('ПЕРСОНАЛ', ['Сотрудники', 'Должности и схемы оплаты', 'Графики работы', 'Начисление зарплаты', 'Выплата зарплаты', 'Статистика по сотрудникам']),
    ('ФИНАНСЫ', ['Кошельки (касса, счета, карты)', 'Доходы', 'Расходы', 'Движение денежных средств (Cashflow)', 'Задолженности (дебиторская / кредиторская)', 'Затраты из личных средств сотрудников']),
    ('АНАЛИТИКА', ['Рентабельность (P&L)', 'ABC-анализ товаров', 'Эффективность рекламы', 'Отчёт по продажам', 'Отчёт по закупкам', 'Прогнозирование', 'Воронка конверсии клиентов']),
    ('МАРКЕТИНГ', ['Рекламные каналы', 'Скидки и акции', 'Промокоды', 'Аналитика по каналам']),
    ('ДОСТАВКА', ['Активные доставки', 'Курьеры', 'Тарифы доставки', 'История доставок']),
    ('НАСТРОЙКИ', ['Торговые точки', 'Склады', 'Роли и права', 'Способы оплаты', 'Статьи расходов', 'Настройки уведомлений', 'Программа лояльности', 'Ценообразование (наценки)', 'Интеграции']),
    ('УВЕДОМЛЕНИЯ', ['Центр уведомлений']),
]

for section_name, items in menu_items:
    add_para(section_name, bold=True, size=Pt(12))
    for item in items:
        add_bullet(item)

doc.add_page_break()

# ============================================================
# 4. МОДУЛЬ «НОМЕНКЛАТУРА»
# ============================================================
add_heading('4. Модуль «Номенклатура»', level=1)

add_heading('4.1. Общая логика', level=2)
add_para('Номенклатура — это справочник всех товарных позиций, участвующих в бизнес-процессах. Каждая позиция имеет уникальный артикул и набор характеристик, зависящих от типа номенклатуры. Номенклатура не хранит остатки — остатки ведутся на складах в рамках партий.')

add_heading('4.2. Типы номенклатуры', level=2)

# Тип 1
add_heading('4.2.1. Тип «Цветы» (живые растения)', level=3)
add_para('Обязательные поля:', bold=True)
fields_flowers = [
    'Название (например, «Роза красная Гран При»)',
    'Артикул (уникальный код, генерируется автоматически или вводится вручную)',
    'Тип цветка (справочник: Роза, Тюльпан, Хризантема, Лилия, Гербера, Пион, Гвоздика, Эустома, Гортензия и т. д.)',
    'Цвет (справочник: Красный, Белый, Розовый, Жёлтый, Оранжевый, Кремовый, Микс и т. д.)',
    'Длина стебля (40 / 50 / 60 / 70 / 80 / 100 см и т. д.)',
    'Страна происхождения (Россия, Эквадор, Кения, Голландия, Колумбия …)',
    'Сорт (например, «Гран При», «Фридом», «Аваланж»)',
    'Единица измерения: штука',
    'Срок свежести (в днях, например 7) — используется для уведомлений об увядании',
    'Минимальный остаток (при достижении → уведомление «Низкий остаток»)',
    'Фото (загрузка нескольких фотографий)',
]
for f in fields_flowers:
    add_bullet(f)

add_para('Дополнительные поля:', bold=True)
for f in ['Описание', 'Особенности ухода', 'Аромат (Да / Нет / Слабый)', 'Размер бутона (Мелкий / Средний / Крупный)']:
    add_bullet(f)

add_para('Расчётные поля (автоматически):', bold=True)
calc_fields = [
    'Средняя цена закупа — средневзвешенная по последним 10 партиям',
    'Последняя цена закупа',
    'Дата последней закупки',
    'Текущий остаток на всех складах (в реальном времени)',
    'Зарезервировано (количество в активных резервах и предзаказах)',
    'Доступно к продаже = Остаток − Резерв',
]
for f in calc_fields:
    add_bullet(f)

# Тип 2
add_heading('4.2.2. Тип «Расходные материалы»', level=3)
add_para('Обязательные поля:', bold=True)
for f in [
    'Название (например, «Плёнка матовая белая»)',
    'Артикул',
    'Подтип (Плёнка / Лента / Сетка / Флористическая губка / Проволока / Тейп-лента и т. д.)',
    'Единица измерения (метр / рулон / штука / килограмм)',
    'Цвет (если применимо)',
    'Размер / характеристики (например, «ширина 60 см», «плотность 40 микрон»)',
    'Норма расхода на 1 стандартный букет (например, 2 метра плёнки)',
    'Минимальный остаток',
    'Фото',
]:
    add_bullet(f)
add_para('Дополнительные поля: Производитель, Срок годности (если применимо).')
add_para('Расчётные поля: Средняя цена закупа, Текущий остаток, Зарезервировано.')

# Тип 3
add_heading('4.2.3. Тип «Декоративные материалы»', level=3)
add_para('Обязательные поля:', bold=True)
for f in [
    'Название (например, «Бусины жемчужные 8 мм»)',
    'Артикул',
    'Подтип (Бусины / Стразы / Бабочки / Птички / Фигурки / Ленты декоративные …)',
    'Единица измерения (штука / грамм / упаковка)',
    'Цвет, Размер',
    'Минимальный остаток',
    'Фото',
]:
    add_bullet(f)

# Тип 4
add_heading('4.2.4. Тип «Сопутствующие товары»', level=3)
add_para('Обязательные поля:', bold=True)
for f in [
    'Название (например, «Открытка "С Днём Рождения"»)',
    'Артикул',
    'Подтип (Открытка / Ваза / Шар воздушный / Мягкая игрушка / Конфеты / Свечи …)',
    'Единица измерения (штука)',
    'Минимальный остаток',
    'Фото',
]:
    add_bullet(f)
add_para('Дополнительные поля: Производитель, Размер, Материал.')

add_para('Важно:', bold=True)
add_para('Все четыре типа участвуют в партионном учёте — каждая поставка создаёт отдельную партию с ценой, датой и поставщиком. Учёт ведётся единообразно: расходные/декоративные материалы и сопутствующие товары проходят через те же складские операции, что и цветы.')

# Тип 5
add_heading('4.2.5. Тип «Букеты» (готовые сборки)', level=3)
add_para('Этот тип создаётся автоматически при комплектации букета. Не добавляется вручную — только через процесс комплектации или шаблоны.')

add_heading('4.3. Шаблоны букетов', level=2)
add_para('Шаблон букета — это «рецепт» создания букета, который можно использовать многократно.')

add_para('Основная информация шаблона:', bold=True)
for f in [
    'Название шаблона (например, «Букет "Париж"»)',
    'Артикул шаблона',
    'Категория (Романтический / Праздничный / Траурный / Свадебный / Повседневный / Корпоративный)',
    'Описание',
    'Фото готового букета (несколько ракурсов)',
    'Ориентировочное время сборки (минуты)',
    'Рекомендуемая цена продажи',
]:
    add_bullet(f)

add_para('Состав шаблона (таблица компонентов):', bold=True)
add_table_simple(
    ['Тип', 'Наименование', 'Кол-во', 'Ед. изм.', 'Обязательный / Заменяемый'],
    [
        ['Цветок', 'Роза красная 70 см', '11', 'шт', 'Обязательный'],
        ['Цветок', 'Роза розовая 70 см', '11', 'шт', 'Обязательный'],
        ['Цветок', 'Роза жёлтая 70 см', '11', 'шт', 'Обязательный'],
        ['Материал', 'Плёнка матовая', '2', 'метр', 'Обязательный'],
        ['Материал', 'Лента атласная красная', '1.5', 'метр', 'Обязательный'],
        ['Декор', 'Бусины жемчужные', '10', 'шт', 'Заменяемый'],
    ]
)

doc.add_paragraph()
add_para('Признак «Обязательный» — без этого компонента букет не может быть собран. «Заменяемый» — можно заменить аналогом или убрать.')

add_para('Расчётные данные шаблона:', bold=True)
for f in [
    'Плановая себестоимость — рассчитывается автоматически на основе средних цен закупа компонентов',
    'Рекомендуемая цена продажи = Плановая себестоимость × Коэффициент наценки (настраивается в разделе «Ценообразование»)',
    'История изменения себестоимости (график)',
    'Статистика: сколько раз собирался, дата последней сборки, средняя цена продажи, средняя маржинальность',
]:
    add_bullet(f)

doc.add_page_break()

# ============================================================
# 5. МОДУЛЬ «СКЛАД»
# ============================================================
add_heading('5. Модуль «Склад»', level=1)

add_heading('5.1. Общая концепция складского учёта', level=2)
add_para('Система поддерживает многоскладской партионный учёт:')
for f in [
    'В рамках одной торговой точки может быть несколько складов (например, «Основной склад», «Витрина», «Холодильник», «Зона комплектации»).',
    'Каждая поступившая партия товара учитывается отдельно.',
    'При списании товара действует правило FIFO.',
    'Для каждой партии фиксируется: дата поступления, поставщик, цена закупа, количество, склад.',
    'Перемещение между складами и торговыми точками сохраняет партию (дата, поставщик и цена не меняются).',
]:
    add_bullet(f)

add_heading('5.2. Справочник «Склады»', level=2)
add_para('Создаётся через Настройки → Склады.')
add_para('Поля:', bold=True)
for f in [
    'Название (например, «Основной склад»)',
    'Тип склада (Основной / Витрина / Холодильник / Зона комплектации / Резервный)',
    'Торговая точка (выбор из справочника)',
    'Ответственное лицо (выбор из сотрудников)',
    'Признак «Склад по умолчанию для букетов» (да / нет) — на этот склад по умолчанию поступают скомплектованные букеты',
    'Признак «Склад по умолчанию для прихода» (да / нет)',
    'Примечания',
]:
    add_bullet(f)

add_heading('5.3. Раздел «Остатки на складах»', level=2)
add_para('Назначение: просмотр текущего состояния товаров на всех складах в реальном времени.')

add_para('Фильтры:', bold=True)
for f in [
    'Склад (один, несколько или «Все склады»)',
    'Тип номенклатуры (Цветы / Материалы / Сопутствующие / Букеты)',
    'Группа товаров (Розы / Тюльпаны / Плёнки …)',
    'Поставщик',
    'Критерий остатка: Все / Ниже минимума / Критически низкий (< 30 % минимума) / Нулевой / С истекающим сроком свежести',
]:
    add_bullet(f)

add_para('Таблица остатков:', bold=True)
add_table_simple(
    ['Фото', 'Артикул', 'Наименование', 'Склад', 'Всего', 'Резерв', 'Доступно', 'Мин. остаток', 'Ср. цена закупа', 'Старейшая партия (дней)'],
    [['—', 'ROS-001', 'Роза красная 70 см', 'Основной', '120', '15', '105', '50', '45 ₽', '3']]
)
doc.add_paragraph()

add_para('Цветовая индикация строк:', bold=True)
for f in [
    'Красная — остаток ниже минимального',
    'Жёлтая — остаток 80–100 % от минимального',
    'Зелёная — остаток в норме',
    'Серая — нулевой остаток',
]:
    add_bullet(f)

add_para('Действия в таблице:', bold=True)
for f in [
    'Клик по строке → Детальная карточка товара с партиями',
    'Кнопка «История движения» → все приходы, расходы, перемещения',
    'Кнопка «Заказать у поставщика» → быстрое создание заявки',
]:
    add_bullet(f)

add_para('Детальная карточка товара:', bold=True)
add_para('Блок 1: Общая информация — все характеристики из справочника номенклатуры + фото.')
add_para('Блок 2: Остатки по складам — таблица: Склад | Количество | Зарезервировано | Доступно.')
add_para('Блок 3: Партии на складе — таблица (сортировка по дате поступления, от старых к новым):')
add_table_simple(
    ['№ партии', 'Дата поступления', 'Возраст (дней)', 'Поставщик', 'Цена закупа', 'Остаток', 'Склад'],
    [['1234', '02.02.2026', '3', 'ФлораТрейд', '45 ₽', '25 шт', 'Основной']]
)
doc.add_paragraph()
add_para('Цветовая индикация партий (для цветов): красная — возраст > срока свежести; жёлтая — 80–100 %; зелёная — свежая.')
add_para('Действия с партией: «Списать» (всю или часть), «Переместить» (на другой склад), «Уценить» (установить спецпредложение для старых цветов).')
add_para('Блок 4: История цен закупа — график динамики цены от разных поставщиков.')
add_para('Блок 5: Статистика — продано за месяц, списано за месяц, % брака, средняя оборачиваемость (дней от прихода до продажи).')

add_heading('5.4. Раздел «Приход товара»', level=2)
add_para('Назначение: оформление поступления товара от поставщика на склад.')

add_para('Шаг 1: Создание приходной накладной', bold=True)
for f in [
    'Дата и время прихода (по умолчанию — текущие)',
    'Поставщик (обязательное поле, выбор из справочника)',
    'Склад назначения (выбор из справочника)',
    'Номер накладной поставщика',
    'Ответственный за приёмку (по умолчанию — текущий пользователь)',
    'Примечание',
]:
    add_bullet(f)

add_para('Шаг 2: Добавление товарных позиций', bold=True)
add_para('Кнопка «+ Добавить позицию» открывает окно выбора номенклатуры.')
add_para('Обязательные поля для каждой позиции:')
for f in [
    'Номенклатура (поиск и выбор из справочника)',
    'Количество',
    'Цена закупа за единицу',
    'Сумма (рассчитывается автоматически)',
]:
    add_bullet(f)
add_para('Дополнительные поля для цветов:')
for f in [
    'Рейтинг качества партии (1–5 звёзд) — влияет на рейтинг поставщика',
    'Количество брака при приёмке',
    'Комментарий по качеству',
]:
    add_bullet(f)

add_para('Обнаружение брака при приёмке:', bold=True)
add_para('Указываем общее количество и количество брака. Принятое = Общее − Брак. Система предлагает: «Создать претензию поставщику?» Если «Да» — создаётся документ «Претензия» с возможностью прикрепить фото брака.')

add_para('Шаг 3: Проведение документа', bold=True)
add_para('При нажатии «Провести документ» происходит:')
for f in [
    'Создание партий товара (для каждой позиции — партия с уникальным номером)',
    'Увеличение остатков на указанном складе',
    'Обновление цен в номенклатуре (фиксация новой цены, пересчёт средней)',
    'Обновление данных поставщика (рейтинг, дата последней поставки)',
    'Создание кредиторской задолженности (если товар не оплачен при поставке)',
    'Регистрация в журнале движения товара (тип «Приход»)',
]:
    add_bullet(f)

add_para('Статусы документа «Приход товара»:', bold=True)
for f in [
    'Черновик — создан, не проведён, можно свободно редактировать',
    'Проведён — товар на складе, редактирование ограничено (только с правами администратора)',
    'Отменён — все движения сторнированы, остатки откатываются',
]:
    add_bullet(f)

add_para('Дополнительные функции: «Печать накладной», «Оплатить поставщику», «Копировать документ» (для регулярных поставок).')

add_heading('5.5. Раздел «Комплектация букетов»', level=2)
add_para('Назначение: создание букетов из цветов и материалов со склада.')

add_para('Режим 1: Комплектация по шаблону', bold=True)
add_para('1) Нажимаем «Создать букет по шаблону».')
add_para('2) Выбираем шаблон из справочника.')
add_para('3) Система показывает состав шаблона, наличие компонентов на складах и дефицит.')
add_para('4) Проверка наличия — таблица с цветовой индикацией: зелёная — хватает, красная — не хватает, жёлтая — хватает, но остаток упадёт ниже минимума.')
add_para('5) При дефиците система предлагает: заказать у поставщика / заменить компонент (для заменяемых) / изменить кол-во.')
add_para('6) Если всё в наличии, заполняем: количество букетов, склад назначения, цену продажи (необязательно).')
add_para('7) Нажимаем «Скомплектовать».')
add_para('При проведении:', bold=True)
for f in [
    'Компоненты списываются со складов по методу FIFO',
    'Рассчитывается фактическая себестоимость каждого букета (на основе реально списанных партий)',
    'На склад назначения поступает готовый букет (новая номенклатура типа «Букет»)',
    'В названии: «Букет "Париж" от [дата]»',
    'Фиксируется себестоимость сборки',
    'Создаётся документ «Комплектация букета» со статусом «Проведён»',
]:
    add_bullet(f)

add_para('Режим 2: Индивидуальная комплектация (разовый букет)', bold=True)
add_para('Вручную добавляем компоненты, указываем количество, склад списания для каждого. Можно загрузить фото готового букета. Есть чекбокс «Сохранить как шаблон» — для сохранения удачного букета в справочник.')

add_para('После комплектации — детализация себестоимости: компонент, кол-во, из какой партии списано, цена партии, стоимость. Итого — фактическая себестоимость букета.')

add_heading('5.6. Раздел «Раскомплектация букетов»', level=2)
add_para('Назначение: разборка готового букета на компоненты с возможностью частичного возврата на склад и частичного списания.')

add_para('Когда используется: клиент вернул букет, букет не продался, ошибка при сборке.')
add_para('Процесс:', bold=True)
add_para('1) Выбираем букет из остатков на складе.')
add_para('2) Система показывает состав букета.')
add_para('3) Для каждого компонента указываем: сколько вернуть на склад, сколько списать.')
add_para('4) Правило: Возврат + Списание = Кол-во в букете (контролируется автоматически).')
add_para('5) Быстрые кнопки: «Всё в списание» / «Всё на склад».')
add_para('6) Указываем причину: Возврат от клиента / Не продано / Брак при сборке / Ошибка комплектации / Увядание / Другое.')
add_para('7) Нажимаем «Раскомплектовать».')

add_para('При проведении:', bold=True)
for f in [
    'Букет списывается со склада',
    'Компоненты «Вернуть на склад» поступают на указанный склад по своей первоначальной себестоимости (НЕ по текущей рыночной цене)',
    'Компоненты «Списать» отражаются в расходах как брак',
    'Создаётся документ «Раскомплектация» со статусом «Проведён»',
]:
    add_bullet(f)

add_heading('5.7. Раздел «Списание товара»', level=2)
add_para('Назначение: списание испорченного, устаревшего или повреждённого товара.')
add_para('Процесс:', bold=True)
for f in [
    'Создать документ списания',
    'Указать: дату, склад, причину (Истёк срок годности / Товар испорчен (завял) / Механическое повреждение / Брак после приёмки / Утрата / Пересортица / Другое)',
    'Указать ответственного, комментарий',
    'Добавить позиции — выбрать конкретную партию, указать количество, прикрепить фото брака',
    'Провести списание',
]:
    add_bullet(f)

add_para('Для цветов система подсвечивает партии с истёкшим сроком красным (приоритет для списания).')

add_para('При проведении: уменьшение остатков, учёт в расходах («Списание»), обновление статистики (% брака), регистрация в журнале.')

add_para('Статусы документа: Черновик → Проведён / Отменён.')

add_heading('5.8. Раздел «Инвентаризация»', level=2)
add_para('Назначение: выявление фактических остатков товара и сравнение с учётными данными.')

add_para('Этапы:', bold=True)
add_para('Этап 1. Создание документа: дата, склад, инвентаризационная комиссия (несколько сотрудников), причина (Плановая / Внеплановая / Смена МОЛ / Проверка).')
add_para('Этап 2. Автоматический снимок учётных остатков на момент начала.')
add_para('Этап 3. Ввод фактических остатков — три режима: по списку, сканированием штрих-кода, свободный ввод.')
add_para('Этап 4. Анализ — система показывает расхождения (недостачи / излишки) с суммами и цветовой индикацией.')
add_para('Этап 5. Решение по расхождениям — для недостач: списать на убыль / удержать с МОЛ / списать на убытки / отложить. Для излишков: оприходовать / отложить.')
add_para('Этап 6. Проведение — корректировка остатков, создание документов списания/оприходования, учёт в финансах, уведомление руководству при превышении порога.')

add_para('Статусы: Подготовка → Ввод данных → Анализ расхождений → Проведена / Отменена.')

add_heading('5.9. Раздел «Перемещение между складами»', level=2)
add_para('Назначение: перемещение товара с одного склада на другой — как в рамках одной торговой точки, так и между точками.')
add_para('Поля: дата, склад-отправитель, склад-получатель, ответственный, причина, комментарий.')
add_para('Позиции: наименование, партия, количество, цена закупа, сумма.')
add_para('ВАЖНО: Партия при перемещении сохраняется полностью (дата прихода, поставщик, цена). Меняется только местоположение.')

add_para('Статусы:', bold=True)
for f in [
    'Черновик',
    'Отправлено (списано с отправителя, ожидает приёмки) — актуально при перемещении между точками',
    'Получено (принято получателем)',
    'Отменено',
]:
    add_bullet(f)

add_heading('5.10. Раздел «Резервирование товара»', level=2)
add_para('Назначение: блокировка товара под конкретный заказ, чтобы его не продали другому покупателю.')
add_para('Резерв создаётся автоматически при оформлении заказа (если включён флаг «Зарезервировать»).')
add_para('Каждый резерв имеет уникальный 6-значный числовой код (например, 123456).')
add_para('Зарезервированный товар остаётся на складе физически, отображается в колонке «Резерв» и недоступен для продажи другим.')

add_para('Таблица резервов:', bold=True)
add_table_simple(
    ['Код резерва', 'Дата', 'Клиент', 'Заказ', 'Номенклатура', 'Кол-во', 'Склад', 'Срок', 'Статус'],
    [['123456', '05.02.26', 'Иванов П.', '1234', 'Роза красная', '15', 'Основной', '08.02.26', 'Активный']]
)
doc.add_paragraph()

add_para('Статусы резерва:', bold=True)
for f in [
    'Активный — резерв действует',
    'Продан — товар продан, резерв закрыт автоматически',
    'Отменён — резерв снят, товар возвращён в продажу',
    'Просрочен — срок резерва истёк (товар автоматически возвращается в доступные)',
]:
    add_bullet(f)

add_para('При продаже: поле «Номер резерва» → ввод 6-значного кода → система подтягивает зарезервированные позиции → оформление продажи → резерв закрывается.')

add_heading('5.11. Раздел «История движения товара»', level=2)
add_para('Полная история всех операций. Фильтры: период, склад, номенклатура, тип операции (Приход / Комплектация / Раскомплектация / Списание / Продажа / Возврат / Перемещение / Инвентаризация), поставщик, документ.')
add_para('Таблица: Дата-время, Тип операции, Документ, Номенклатура, Приход, Расход, Остаток после, Склад, Партия, Ответственный.')
add_para('Цветовая индикация: зелёный — приходные, красный — расходные, синий — перемещения, жёлтый — инвентаризация.')
add_para('Экспорт в Excel, печать отчёта.')

doc.add_page_break()

# ============================================================
# 6. МОДУЛЬ «ПРОДАЖИ И ЗАКАЗЫ»
# ============================================================
add_heading('6. Модуль «Продажи и заказы»', level=1)

add_heading('6.1. Быстрая продажа', level=2)
add_para('Назначение: максимально быстрое оформление продажи «здесь и сейчас».')

add_para('Интерфейс (экран оптимизирован для скорости):', bold=True)

add_para('Блок 1: Товарные позиции', bold=True)
add_para('Способы добавления: сканирование штрих-кода; быстрые кнопки с популярными товарами (настраиваются); поиск по названию / артикулу; ввод кода резерва (подтягивает зарезервированные товары).')

add_para('Блок 2: Скидка (опционально)', bold=True)
add_para('Процентная скидка (%), фиксированная скидка (₽), промокод (система проверяет и применяет автоматически), скидка из программы лояльности.')

add_para('Блок 3: Итоговая сумма', bold=True)
add_para('Крупным шрифтом: ИТОГО К ОПЛАТЕ.')

add_para('Блок 4: Клиент (опционально)', bold=True)
add_para('Поиск по телефону или имени. Если новый — мини-форма: ФИО, телефон, источник привлечения. Можно продавать без указания клиента (анонимная продажа).')

add_para('Блок 5: Способ оплаты', bold=True)
add_para('Наличные / Банковская карта / Онлайн (СБП, QR) / Смешанная оплата (указываются суммы по каждому способу) / На личную карту сотрудника.')

add_para('Блок 6: Продавец', bold=True)
add_para('Подставляется автоматически (текущий пользователь), можно выбрать другого.')

add_para('Кнопка «ПРОДАТЬ»', bold=True)
add_para('Что происходит при нажатии:')
for f in [
    'Создание документа «Чек продажи» (дата, время, клиент, продавец, способ оплаты)',
    'Списание товара со склада по FIFO из старейших партий',
    'Автоматический расчёт себестоимости и прибыли',
    'Оприходование денег в соответствующий кошелёк (касса / р/с)',
    'Начисление зарплаты продавцу (если настроен процент от продаж)',
    'Обновление истории клиента (если указан)',
    'Начисление бонусов (если подключена программа лояльности)',
    'Печать / отправка чека',
]:
    add_bullet(f)

add_para('Дополнительно: «Отложить» (сохранить в черновик), «Очистить», чекбокс «Печатать чек».')

add_para('Смешанная оплата:', bold=True)
add_para('При выборе смешанной оплаты появляются поля для ввода суммы по каждому способу. Система контролирует, чтобы сумма всех частей равнялась итоговой сумме чека. Каждая часть оприходуется в соответствующий кошелёк.')

add_para('Оплата на личную карту сотрудника:', bold=True)
add_para('Если клиент переводит деньги на личную карту сотрудника — система автоматически создаёт дебиторскую задолженность сотрудника перед магазином на сумму перевода. Погашается при внесении сотрудником наличных в кассу или переводом на р/с.')

add_heading('6.2. Оформление заказа / предзаказа', level=2)
add_para('Назначение: оформление заказа с датой исполнения в будущем, поддержкой предоплаты и резервирования.')
add_para('Отличие от быстрой продажи: быстрая продажа — клиент купил и забрал сразу; заказ — товар готовится к определённой дате.')

add_para('Блок 1: Основная информация', bold=True)
for f in [
    'Номер заказа — 4-значный, генерируется автоматически по возрастанию',
    'Поиск заказа: по номеру заказа или по последним цифрам телефона клиента; по умолчанию — только по активным заказам (галочка «Искать в выданных»)',
    'Дата создания (текущая)',
    'Дата исполнения (обязательно) + Время исполнения',
    'Клиент (выбор из базы или создание нового)',
    'Способ получения: Самовывоз / Доставка',
    'Продавец (кто принял заказ)',
]:
    add_bullet(f)

add_para('Блок 2: Товарные позиции', bold=True)
add_para('Аналогично быстрой продаже + чекбокс «Зарезервировать» по каждой позиции.')

add_para('Блок 3: Доставка (при выборе «Доставка»)', bold=True)
for f in [
    'Адрес (выбор из сохранённых или ввод нового)',
    'Получатель (если отличается от заказчика)',
    'Телефон получателя',
    'Комментарий к доставке',
    'Стоимость доставки (авто-расчёт по тарифам или ввод вручную)',
    'Курьер (назначается позднее)',
]:
    add_bullet(f)

add_para('Блок 4: Оплата', bold=True)
add_para('Общая сумма = товары + доставка − скидка. Варианты: предоплата (частичная или полная, указывается сумма и способ), оплата при получении, оплата в долг (корпоративные клиенты).')

add_para('Блок 5: Комментарий к заказу', bold=True)
add_para('Свободное поле: состав букета, текст на открытке, особые пожелания.')

add_para('Создание заказа — что происходит:', bold=True)
for f in [
    'Создаётся документ «Заказ клиента» со статусом «Новый»',
    'Товар резервируется (если чекбокс включён), создаётся резерв с 6-значным кодом, срок = дата исполнения + 1 день',
    'Предоплата оприходуется в кошелёк',
    'Создаётся задача на комплектацию (если заказаны букеты)',
    'Создаётся задача на доставку (если заказана)',
]:
    add_bullet(f)

add_para('Жизненный цикл заказа (статусы):', bold=True)
statuses_order = [
    ('Новый', 'Заказ создан, ожидает обработки'),
    ('В работе', 'Заказ взят в обработку, букет собирается'),
    ('Готов', 'Заказ укомплектован, клиенту отправляется уведомление'),
    ('Выдан / Доставлен', 'Товар передан клиенту, произведена финальная оплата, резерв закрыт'),
    ('Отменён', 'Резерв снят, предоплата возвращена'),
]
for s, desc in statuses_order:
    add_para(f'{s} — {desc}')

add_para('Быстрые кнопки переключения статуса: «Взять в работу», «Заказ готов», «Выдать заказ», «Отменить заказ».')

add_para('Выдача заказа:', bold=True)
add_para('Находим заказ → проверяем статус «Готов» → «Выдать заказ» → финальная оплата (сумма − предоплата) → списание товара → закрытие резерва → начисление зарплаты → обновление статистики → печать чека.')

add_heading('6.3. Раздел «Список заказов»', level=2)
add_para('Фильтры: период, статус, клиент, продавец, способ получения.')
add_para('Вкладки: «Сегодня», «Завтра», «Все активные», «История».')
add_para('Цветовая индикация: красная — просрочен, жёлтая — на сегодня, зелёная — будущие.')

add_heading('6.4. Возвраты от клиентов', level=2)
add_para('Назначение: оформление возврата товара. Причины: брак, передумал, ошибка комплектации, другое.')
add_para('Процесс:')
for f in [
    'Выбираем документ продажи (чек или заказ)',
    'Указываем позиции и количество для возврата (возможен частичный возврат)',
    'Для букетов: раскомплектовать или списать полностью',
    'Для цветов и товаров: вернуть на склад или списать',
    'Способ возврата денег: наличные / на карту / зачёт (выбор другого товара) / без возврата (порча по вине клиента)',
]:
    add_bullet(f)

add_para('При проведении: создание документа «Возврат», возврат денег, корректировка статистики (выручка, продавец, рейтинг товара), обновление истории клиента.')

doc.add_page_break()

# ============================================================
# 7. МОДУЛЬ «КЛИЕНТЫ»
# ============================================================
add_heading('7. Модуль «Клиенты»', level=1)

add_heading('7.1. Типы клиентов', level=2)
add_para('Частные лица (физические лица) и Корпоративные клиенты (юридические лица).')

add_heading('7.2. Карточка частного клиента', level=2)

add_para('Блок 1: Основная информация', bold=True)
for f in [
    'ФИО (полностью)',
    'Дата рождения (опционально)',
    'Пол (М / Ж) — для корректного обращения',
    'Фото (опционально)',
    'Статус клиента: Активный / Редкий / VIP / Чёрный список',
]:
    add_bullet(f)
add_para('Примечание: статус «VIP» выделяется золотым/фиолетовым цветом (не красным, чтобы не путать с негативным). «Чёрный список» — серая индикация.')

add_para('Блок 2: Контакты', bold=True)
for f in [
    'Телефон (основной) — обязательное поле',
    'Дополнительный телефон',
    'Email',
    'Мессенджеры (WhatsApp / Telegram / Viber)',
    'Адрес (для доставки по умолчанию)',
]:
    add_bullet(f)

add_para('Блок 3: Знаменательные даты', bold=True)
add_para('Неограниченное количество записей. Каждая запись: тип события (настраиваемый справочник: ДР, годовщина, ДР родственника, профессиональный праздник, другое), дата, описание, за сколько дней напомнить (по умолчанию 3).')
add_para('Логика уведомлений: напоминание за X дней до события (настраивается индивидуально для каждой записи) + в день события утром. Уведомление содержит: ФИО, тип события, дату, историю покупок, кнопку «Позвонить».')

add_para('Блок 4: Источник привлечения', bold=True)
add_para('Выбор из списка рекламных каналов (Instagram, ВКонтакте, Яндекс.Директ, рекомендация, проходил мимо, листовки, другое). Связан с модулем «Маркетинг» для оценки ROI.')

add_para('Блок 5: Рейтинг клиента', bold=True)
add_para('Устанавливается вручную продавцом (1–5 звёзд). Рекомендации: 5 — VIP, частые и крупные покупки; 4 — регулярные покупки; 3 — периодический; 2 — 1–2 раза; 1 — проблемный.')

add_para('Блок 6: История покупок', bold=True)
add_para('Таблица: дата, документ, товар/букет, кол-во, сумма, продавец, способ оплаты. Итого: всего покупок, общая сумма, средний чек, любимые товары (топ‑3).')

add_para('Блок 7: Адреса доставки', bold=True)
add_para('Таблица сохранённых адресов с указанием получателя, телефона, комментария, флага «по умолчанию».')

add_para('Блок 8: Дебиторская задолженность', bold=True)
add_para('Если клиент покупал в долг: сумма долга, дата, срок погашения, просрочка.')

add_para('Блок 9: Бонусная программа (если подключена)', bold=True)
add_para('Текущий баланс бонусов, история начислений и списаний.')

add_para('Блок 10: Комментарии и заметки', bold=True)
add_para('Свободное текстовое поле с датой и автором. Пример: «Клиент предпочитает нежные тона. Аллергия на гипсофилу.»')

add_heading('7.3. Карточка корпоративного клиента', level=2)
add_para('Дополнительные блоки (помимо аналогичных полям частного клиента):')
for f in [
    'Реквизиты компании (полное название, ИНН, КПП, ОГРН, юр. адрес, факт. адрес, банковские реквизиты)',
    'Контактные лица (таблица: ФИО, должность, телефон, email, примечание)',
    'Условия сотрудничества (скидка %, отсрочка платежа, мин. сумма заказа, договор PDF)',
    'История корпоративных заказов (дата, повод, кол-во букетов, сумма, статус оплаты)',
]:
    add_bullet(f)

add_heading('7.4. Раздел «Знаменательные даты»', level=2)
add_para('Центральный просмотр всех знаменательных дат с фильтрацией.')
add_para('Вкладка «Сегодня» — клиенты с событиями сегодня (ФИО, событие, телефон, последняя покупка, что обычно покупает, кнопки действий).')
add_para('Вкладка «Ближайшие» — группировка по датам: завтра, через 2 дня, через 3 дня… (настраивается горизонт: 3 / 7 / 14 / 30 дней).')
add_para('Вкладка «Календарь» — календарное отображение по месяцам.')
add_para('Действия: «Позвонить», «Отправить поздравление» (SMS / WhatsApp), «Создать заказ».')

doc.add_page_break()

# ============================================================
# 8. МОДУЛЬ «ПОСТАВЩИКИ»
# ============================================================
add_heading('8. Модуль «Поставщики»', level=1)

add_heading('8.1. Карточка поставщика', level=2)

add_para('Блок 1: Основная информация', bold=True)
for f in [
    'Название организации, краткое название',
    'Тип: Оптовый поставщик цветов / Производитель / Дистрибьютор материалов / Поставщик сопутствующих товаров',
    'Страна, город',
    'Статус: Активный / Временно не работаем / Прекращено / Чёрный список',
    'Общий рейтинг (расчётный)',
]:
    add_bullet(f)

add_para('Блок 2: Реквизиты', bold=True)
add_para('ИНН, КПП, ОГРН, юридический адрес, фактический адрес, банковские реквизиты (банк, БИК, корр. счёт, р/с).')

add_para('Блок 3: Контакты', bold=True)
add_para('Таблица контактных лиц: ФИО, должность, телефон, доп. телефон, email, мессенджер, примечание.')

add_para('Блок 4: Условия сотрудничества', bold=True)
for f in [
    'Минимальная сумма заказа',
    'Условия оплаты (предоплата 100 % / 50 % + остаток / при получении / отсрочка X дней)',
    'Срок доставки (в тот же день / на следующий / 2–3 дня / более 3 дней)',
    'Дни поставок (например, Вт, Пт)',
    'Время поставки',
    'Стоимость доставки',
]:
    add_bullet(f)

add_para('Блок 5: Рейтинг и статистика', bold=True)
add_para('Общий рейтинг рассчитывается автоматически по формуле:')
add_para('Рейтинг = Качество товара × 0,5 + Соблюдение сроков × 0,3 + (100 % − % брака) × 0,2', italic=True)
add_para('Качество товара — средневзвешенный рейтинг по всем партиям (1–5 звёзд). Соблюдение сроков — процент поставок вовремя. % брака — доля брака от общего объёма.')
add_para('Статистика: дата начала сотрудничества, дата последней поставки, всего поставок, общая сумма закупок, средняя сумма, текущая задолженность.')

add_para('Блок 6: Документы и файлы', bold=True)
add_para('Договор (PDF), прайс-листы (с датами), сертификаты, другие документы.')

add_para('Блок 7: История взаимодействия', bold=True)
add_para('Все приходы товара (суммы, даты), все платежи, претензии, заметки.')

add_heading('8.2. Номенклатура поставщиков', level=2)
add_para('Заполняется автоматически при приёмке. Таблица: наименование, последняя цена, дата, рейтинг качества. Кнопка «История цен» — график динамики.')
add_para('Сравнение поставщиков: в карточке номенклатуры → вкладка «Поставщики» → сравнительная таблица цен, рейтингов и сроков.')

add_heading('8.3. Задолженность (кредиторская)', level=2)
add_para('Возникает при проведении прихода без оплаты. Таблица: поставщик, сумма, дата, документ, срок, просрочка, статус. Цветовая индикация: зелёная — в срок, жёлтая — через 1–3 дня, красная — просрочка.')
add_para('Погашение: кнопка «Оплатить» → РКО или платёжное поручение → задолженность уменьшается.')

add_heading('8.4. Брак и претензии', level=2)
add_para('При обнаружении брака на приёмке → форма претензии: поставщик, документ, номенклатура, кол-во, сумма, описание, фото, требование (замена / возврат денег / скидка / другое).')
add_para('Статусы: Отправлена → На рассмотрении → Удовлетворена / Отклонена / Закрыта без решения.')

doc.add_page_break()

# ============================================================
# 9. МОДУЛЬ «ПЕРСОНАЛ»
# ============================================================
add_heading('9. Модуль «Персонал»', level=1)

add_heading('9.1. Карточка сотрудника', level=2)
add_para('Блок 1: Личные данные — ФИО, дата рождения, паспорт, адрес, телефон, email, фото.')
add_para('Блок 2: Трудовая информация — должность, дата приёма, дата увольнения, статус (Работает / В отпуске / Уволен / На больничном), торговая точка, МОЛ (да/нет).')
add_para('Блок 3: Доступ в систему — логин, пароль, роль (Владелец / Администратор / Менеджер / Продавец / Курьер / Бухгалтер).')
add_para('Блок 4: Система оплаты труда — назначается из схем, настроенных для должности (см. ниже). Возможна индивидуальная настройка для конкретного сотрудника.')
add_para('Блок 5: Статистика работы — кол-во смен (месяц / всего), общая сумма продаж, средний чек, накопленная зарплата, выплачено.')
add_para('Блок 6: Графики работы — календарь смен.')
add_para('Блок 7: Документы — трудовой договор, должностная инструкция, прочие.')

add_heading('9.2. Справочник «Должности»', level=2)
add_para('Примеры: Продавец-флорист, Флорист, Администратор, Курьер, Уборщица, Бухгалтер.')
add_para('Каждая должность содержит описание обязанностей и систему оплаты труда.')

add_heading('9.3. Система оплаты труда', level=2)
add_para('Настраивается на уровне должности, затем применяется к сотрудникам. При необходимости — индивидуальная настройка для конкретного сотрудника.')

add_para('Компонент 1: Оплата за смену (фиксированная ставка)', bold=True)
add_para('Стоимость полной смены (например, 1500 ₽). Длительность полной смены (например, 12 часов). При неполной смене — оплата пропорционально: отработал 6 ч (50 %) → 750 ₽. Можно также задать повышенную ставку для определённых дней недели (пятница, суббота: 1800 ₽).')

add_para('Компонент 2: Процент от продаж', bold=True)
add_para('Вариант А: Фиксированный процент (например, 5 % от выручки продавца). Важно: процент считается от выручки за вычетом стоимости доставки (доставка — это услуга, а не заслуга продавца).')

add_para('Вариант Б: Прогрессивная шкала — процент зависит от объёма продаж за смену:')
add_table_simple(
    ['Выручка за смену', 'Процент'],
    [
        ['До 10 000 ₽', '3 %'],
        ['10 001 – 30 000 ₽', '5 %'],
        ['30 001 – 50 000 ₽', '7 %'],
        ['Свыше 50 000 ₽', '10 %'],
    ]
)
doc.add_paragraph()
add_para('Расчёт: каждый диапазон считается отдельно. Например, при выручке 35 000 ₽: первые 10 000 × 3 % = 300 + следующие 20 000 × 5 % = 1 000 + последние 5 000 × 7 % = 350 → Итого: 1 650 ₽.')

add_para('Компонент 3: Потолок зарплаты', bold=True)
add_para('Максимальная сумма за день/месяц. Если расчёт превышает потолок, выплачивается потолок.')

add_para('Компонент 4: Минимальная гарантия', bold=True)
add_para('Минимальная оплата за смену. Даже если по расчётам выходит меньше — выплачивается минимум.')

add_para('Итоговая формула:', bold=True)
add_para('ЗП за смену = MAX(Минимальная гарантия, MIN(Оплата за смену + Процент от продаж, Потолок))', italic=True)

add_para('Компонент 5: Распределение при нескольких продавцах в смену', bold=True)
add_para('Два варианта (настраивается):')
for f in [
    'По фактическим продажам — каждый получает процент только со своих продаж (фиксируется в чеке)',
    'Равное распределение — общая выручка делится поровну между всеми продавцами смены',
]:
    add_bullet(f)

add_heading('9.4. Графики работы', level=2)
add_para('Календарь смен с возможностью назначения вручную, через шаблоны (2/2, 5/2) или автозаполнение.')
add_para('Отметка о выходе/уходе: сотрудник нажимает «Вышел на смену» / «Ушёл со смены». Если фактическое время отличается от планового — администратор решает: оплачивать факт или план.')

add_heading('9.5. Начисление зарплаты', level=2)
add_para('Зарплата начисляется автоматически:')
for f in [
    'При оформлении продажи → процент от продажи',
    'При закрытии смены → оплата за смену',
]:
    add_bullet(f)
add_para('Все начисления накапливаются в «Накопленной зарплате» сотрудника. Таблица: дата, сотрудник, тип начисления, основание, сумма.')

add_heading('9.6. Выплата зарплаты', level=2)
add_para('Документ «Выплата зарплаты»: выбор сотрудника, показ накопленной суммы, ввод суммы к выплате (можно частично), способ выплаты:')
for f in [
    'Наличные из кассы магазина (напрямую, без инкассации)',
    'Перевод на карту сотрудника',
    'Другое',
]:
    add_bullet(f)
add_para('При проведении: уменьшение накопленной ЗП, списание денег из кошелька, отражение в расходах (статья «Заработная плата»).')

doc.add_page_break()

# ============================================================
# 10. МОДУЛЬ «ФИНАНСЫ И КОШЕЛЬКИ»
# ============================================================
add_heading('10. Модуль «Финансы и кошельки»', level=1)

add_heading('10.1. Концепция кошельков', level=2)
add_para('Вместо жёстко зашитых «Касса» / «Р/с» система использует настраиваемые кошельки. Каждый кошелёк — это место хранения денег.')

add_para('Предустановленные кошельки (создаются автоматически):', bold=True)
for f in [
    'Касса (наличные в магазине)',
    'Расчётный счёт (безналичные)',
    'Дебетовая карта (карта собственника)',
    'Накопительная касса (средства «под подушкой»)',
]:
    add_bullet(f)

add_para('Пользователь может создать дополнительные кошельки. Для каждого кошелька настраивается:', bold=True)
for f in [
    'Название',
    'Тип (наличный / безналичный)',
    'Валюта (₽ по умолчанию)',
    'Разрешён ли отрицательный баланс (да / нет) — ВАЖНО для кошельков типа «Личные средства сотрудника»',
    'Ответственное лицо',
]:
    add_bullet(f)

add_para('Пример: кошелёк «Диана» — личные средства сотрудника Дианы, используемые для закупок. Баланс может уходить в минус (магазин будет должен Диане). При проведении прихода товара, оплаченного Дианой из личных средств, баланс кошелька «Диана» уменьшается. Погашение долга — через документ «Выплата из кассы» в пользу кошелька «Диана».')

add_heading('10.2. Операции с кошельками', level=2)

add_para('Приходный кассовый ордер (ПКО):', bold=True)
add_para('Поступление денег в кошелёк. Типы: выручка от продаж (автоматически), взнос владельца, возврат от поставщика, получение долга от клиента, другое.')

add_para('Расходный кассовый ордер (РКО):', bold=True)
add_para('Списание денег из кошелька. Типы: оплата поставщику, зарплата, аренда, прочие расходы, возврат клиенту, изъятие владельцем, другое.')

add_para('Перемещение между кошельками:', bold=True)
add_para('Например, инкассация (из кассы на р/с). Деньги списываются из одного кошелька и зачисляются в другой. Можно настроить задержку зачисления (например, инкассация зачисляется на следующий день).')

add_para('Журнал операций: дата-время, тип, документ, приход, расход, остаток, основание.')

add_heading('10.3. Раздел «Доходы»', level=2)
add_para('Типы доходов: выручка от продаж (авто, разбивка по категориям: цветы / букеты / сопутствующие / доставка), прочие доходы (возврат от поставщика, проценты и т. д.).')
add_para('Отчёт: фильтры (период, статья, способ оплаты), итоги (всего / наличные / безнал).')

add_heading('10.4. Раздел «Расходы»', level=2)
add_para('Автоматические статьи расходов:', bold=True)
for f in [
    'Себестоимость проданных товаров — рассчитывается автоматически при продаже (партионный FIFO-учёт)',
    'Списание (брак/порча) — автоматически при списании',
    'Заработная плата — начисленная (НЕ выплаченная) зарплата. Учитывается в расходах в момент начисления, чтобы понимать реальную картину прибыли',
    'Реклама — автоматически из модуля «Маркетинг»',
]:
    add_bullet(f)

add_para('Ручные статьи расходов:', bold=True)
for f in [
    'Аренда помещения',
    'Интернет, телефония',
    'Охрана, видеонаблюдение',
    'Коммунальные платежи',
    'Уборка',
    'Расходные материалы (не для продажи)',
    'Ремонт и обслуживание оборудования',
    'Налоги, банковские комиссии',
    'Бензин/транспорт для доставки',
    'Бухгалтерские услуги',
    'Другое (можно создать любую статью)',
]:
    add_bullet(f)

add_para('Настройка периодичности (через «Настройки → Статьи расходов»):', bold=True)
add_para('Для каждой ручной статьи можно указать: разовый платёж / ежемесячный (число месяца) / еженедельный (день недели) / ежегодный. Сумма (фиксированная или переменная). Система автоматически создаёт документ расхода в статусе «Запланирован» и уведомляет о наступлении даты оплаты.')

add_para('Статусы платежей: Запланирован → Оплачен / Просрочен.')

add_heading('10.5. Раздел «Движение денежных средств» (Cashflow)', level=2)
add_para('Текущая ликвидность: общий остаток, разбивка по кошелькам.')
add_para('Планируемые поступления и выплаты — таблица на ближайшую неделю: дата, событие, приход, расход, прогнозный остаток. Цветовая индикация: зелёная — норма, жёлтая — ниже установленного минимума, красная — кассовый разрыв.')
add_para('Прогноз кассового разрыва: если система прогнозирует дефицит — предупреждение с рекомендациями (отложить платёж, перенести зарплату, взять из личных средств, ускорить получение долгов).')

add_heading('10.6. Раздел «Задолженности»', level=2)
add_para('Дебиторская задолженность (нам должны):', bold=True)
for f in [
    'Клиенты (купили в долг)',
    'Сотрудники (получили деньги на личную карту, ещё не внесли в кассу)',
]:
    add_bullet(f)

add_para('Кредиторская задолженность (мы должны):', bold=True)
for f in [
    'Поставщики (товар получен, не оплачен)',
    'Сотрудники (начисленная, не выплаченная зарплата)',
    'Сотрудники (оплатили расходы из личных средств — магазин должен вернуть)',
]:
    add_bullet(f)

add_heading('10.7. Раздел «Затраты из личных средств сотрудников»', level=2)
add_para('Назначение: учёт расходов, оплаченных сотрудниками из личных средств.')
add_para('Форма: выбор сотрудника, сумма, статья расходов, документ-подтверждение (чек), дата, комментарий.')
add_para('При внесении: система создаёт кредиторскую задолженность перед сотрудником. Погашение — из кассы наличными или переводом на карту.')

doc.add_page_break()

# ============================================================
# 11. МОДУЛЬ «АНАЛИТИКА»
# ============================================================
add_heading('11. Модуль «Аналитика»', level=1)

add_heading('11.1. Рентабельность (P&L — Прибыли и убытки)', level=2)
add_para('Выбор периода: день / неделя / месяц / квартал / год / произвольный.')
add_para('Отчёт:')
add_para("""
ДОХОДЫ:
  Выручка от продажи товаров ... 500 000 ₽
  Доставка ..................... 15 000 ₽
  Прочие доходы ................ 5 000 ₽
  ИТОГО ДОХОДОВ: 520 000 ₽

РАСХОДЫ:
  Себестоимость проданных товаров ... 250 000 ₽
  Списание брака ................... 12 000 ₽
  Заработная плата ................. 80 000 ₽
  Реклама .......................... 25 000 ₽
  Аренда ........................... 50 000 ₽
  Коммунальные ..................... 8 000 ₽
  Интернет и связь ................. 3 000 ₽
  Прочие расходы ................... 7 000 ₽
  ИТОГО РАСХОДОВ: 435 000 ₽

ПРИБЫЛЬ: 85 000 ₽
РЕНТАБЕЛЬНОСТЬ: 16,3 %
""")
add_para('Графики: доходы, расходы, прибыль по дням/неделям/месяцам. Круговая диаграмма структуры расходов.')

add_heading('11.2. ABC-анализ товаров', level=2)
add_para('A-категория (20 % товаров → 80 % прибыли) — самые важные. B-категория (30 % → 15 % прибыли). C-категория (50 % → 5 % прибыли).')
add_para('Таблица: товар, продано (шт), выручка, себестоимость, прибыль, доля в прибыли, категория.')
add_para('Рекомендации системы: следить за наличием A-товаров, пересмотреть ассортимент C-товаров.')

add_heading('11.3. Эффективность рекламы', level=2)
add_para('Связь: при создании клиента указывается источник → при продаже фиксируется клиент → система связывает продажи с каналами.')
add_para('Таблица: канал, вложено, привлечено клиентов, выручка, прибыль, ROI. ROI = (Прибыль − Вложения) ÷ Вложения × 100 %.')
add_para('Рекомендации: увеличить бюджет каналов с высоким ROI, пересмотреть каналы с низким.')

add_heading('11.4. Прогнозирование', level=2)
add_para('Сезонный прогноз: анализ продаж за прошлые периоды, выявление пиков (14 февраля, 8 марта, 1 сентября, Новый год) и спадов (июль–август). Рекомендации по запасам.')
add_para('Прогноз по дням недели: пики (Пт–Вс), спады (Пн–Вт). Рекомендации по закупкам.')
add_para('Прогнозная потребность: на основе средних продаж за последние N недель — рекомендуемый объём закупки с учётом текущих остатков.')

add_heading('11.5. Воронка конверсии клиентов', level=2)
add_para('Анализ: сколько новых клиентов → сколько сделали первую покупку → сколько стали постоянными. Метрики: Retention Rate (возвращаемость), LTV (пожизненная ценность клиента), средний цикл покупки.')

doc.add_page_break()

# ============================================================
# 12. МОДУЛЬ «МАРКЕТИНГ»
# ============================================================
add_heading('12. Модуль «Маркетинг»', level=1)

add_heading('12.1. Рекламные каналы', level=2)
add_para('Справочник каналов: название, тип (Контекстная / Соцсети / Наружная / Печатная / Радио-ТВ / Другое), статус (Активный / Приостановлен / Завершён).')
add_para('Журнал инвестиций по каждому каналу: дата, сумма, цель кампании, комментарий.')
add_para('Итоги: всего вложено, привлечено клиентов, CAC (стоимость привлечения = вложено ÷ привлечённых).')

add_heading('12.2. Скидки и акции', level=2)
add_para('Типы скидок: процентные (на чек или товар), фиксированные (₽), акции «X по цене Y» (3 розы по цене 2), подарки (при покупке от X ₽).')
add_para('Создание: название, тип, период, условия (мин. сумма, конкретные товары, категории клиентов), размер, лимит применений.')
add_para('Применение: продавец выбирает из списка активных, скидка рассчитывается автоматически.')
add_para('Статистика: сколько раз применено, выручка с акцией, упущенная выгода, эффективность (прирост продаж, новые клиенты).')

add_heading('12.3. Промокоды', level=2)
add_para('Создание: код, тип скидки, размер, период, ограничение (одноразовый / многоразовый / ограниченный лимит), мин. сумма.')
add_para('Применение: продавец вводит код → система проверяет валидность → применяет скидку.')
add_para('Статистика: использовано / лимит, выручка, упущенная выгода, статус.')

doc.add_page_break()

# ============================================================
# 13. МОДУЛЬ «ДОСТАВКА»
# ============================================================
add_heading('13. Модуль «Доставка»', level=1)

add_heading('13.1. Справочник «Курьеры»', level=2)
add_para('ФИО, телефон, статус (Работает / Не работает), транспорт (Пеший / Велосипед / Мотоцикл / Автомобиль), график работы, фото, процент от доставок (если применимо). Курьеры могут быть как штатными, так и привлечёнными (аутсорс).')

add_heading('13.2. Тарифы доставки', level=2)
add_para('Настраиваются в «Настройки → Доставка».')
add_para('Варианты тарификации:')
for f in [
    'Фиксированная стоимость (по городу / за город)',
    'Зонирование (создание зон с разной стоимостью)',
    'По расстоянию (базовая ставка + за каждый км)',
    'Бесплатная доставка при заказе от X ₽',
]:
    add_bullet(f)

add_heading('13.3. Активные доставки', level=2)
add_para('Вкладки: «Ожидают отправки», «В доставке», «Доставлено сегодня», «Все».')
add_para('Таблица: № заказа, клиент, адрес, время, курьер, статус, стоимость, действия.')

add_para('Статусы доставки:', bold=True)
for f in [
    'Ожидает отправки',
    'Передан курьеру',
    'В пути',
    'Доставлен',
    'Отменён',
    'Проблема (клиента нет, неверный адрес и т. д.)',
]:
    add_bullet(f)

add_para('Маршрутный лист формируется для курьера при нескольких доставках.')
add_para('Обновление статуса: курьер (или менеджер) обновляет статус. При «Доставлен» — фиксация оплаты, фото, комментарий. При «Проблема» — указание причины, уведомление менеджеру.')

doc.add_page_break()

# ============================================================
# 14. МОДУЛЬ «НАСТРОЙКИ»
# ============================================================
add_heading('14. Модуль «Настройки»', level=1)

add_heading('14.1. Торговые точки', level=2)
add_para('Карточка: название, адрес, телефон, режим работы, руководитель, фото. Для сетевых бизнесов — перемещение товара между точками, аналитика по каждой точке.')

add_heading('14.2. Склады', level=2)
add_para('Описано в разделе 5.2.')

add_heading('14.3. Роли и права', level=2)
add_para('Описано в разделе 17.')

add_heading('14.4. Способы оплаты', level=2)
add_para('Предустановленные: Наличные, Банковская карта, Онлайн (СБП, QR), Смешанная оплата, На личную карту сотрудника.')
add_para('Для каждого: название, тип (наличный / безналичный), активен (да / нет), комиссия (если есть, например 2 % с безнала).')

add_heading('14.5. Статьи расходов', level=2)
add_para('Описано в разделе 10.4.')

add_heading('14.6. Настройки уведомлений', level=2)
add_para('Типы: Критические (нельзя отключить), Важные (по умолчанию вкл.), Информационные (можно отключить).')
add_para('Для каждого: включено (да/нет), канал (в системе / email / SMS / WhatsApp / Telegram), кому, когда.')

add_heading('14.7. Программа лояльности', level=2)
add_para('Описано в разделе 20.')

add_heading('14.8. Ценообразование (наценки)', level=2)
add_para('Назначение: централизованное управление наценкой.')
add_para('Настройки:')
for f in [
    'Коэффициент наценки по умолчанию (например, ×2.5 — себестоимость 100 ₽ → цена 250 ₽)',
    'Коэффициент по категориям товаров (цветы — ×2.5, сопутствующие — ×3, доставка — фиксированная)',
    'Сезонные коэффициенты (14 февраля, 8 марта — повышенная наценка)',
    'Минимальная маржинальность (система предупреждает, если цена продажи ниже порога)',
]:
    add_bullet(f)

add_heading('14.9. Интеграции', level=2)
for f in [
    'Телефония (IP-телефония: открытие карточки клиента при звонке, запись разговоров)',
    'Мессенджеры (WhatsApp Business API, Telegram Bot)',
    'Онлайн-касса (54-ФЗ, фискализация чеков)',
    'Бухгалтерия (1С, Моё дело, Контур)',
    'Банк (выписки, сопоставление платежей)',
    'Сайт / соцсети (приём заказов)',
]:
    add_bullet(f)

doc.add_page_break()

# ============================================================
# 15. УВЕДОМЛЕНИЯ
# ============================================================
add_heading('15. Модуль «Уведомления»', level=1)

add_para('Критические (красные, нельзя отключить):', bold=True)
for f in [
    'Кассовый разрыв — при прогнозе дефицита средств',
    'Критически низкие остатки — остаток < 30 % минимума',
    'Просроченные заказы — дата исполнения прошла, заказ не выдан',
]:
    add_bullet(f)

add_para('Важные (жёлтые, по умолчанию включены):', bold=True)
for f in [
    'Знаменательные даты клиентов — за X дней с кнопкой «Позвонить»',
    'Истекающий срок свежести цветов — с кнопками «Уценить» / «Списать»',
    'Низкие остатки товара — с кнопкой «Заказать»',
    'Долги поставщикам — с кнопкой «Оплатить»',
    'Предзаказы на сегодня/завтра',
]:
    add_bullet(f)

add_para('Информационные (синие, можно отключить):', bold=True)
for f in [
    'Новые заказы (особенно актуально при приёме с сайта)',
    'Ежедневная сводка (выручка, продажи, средний чек)',
    'Еженедельная аналитика (выручка, прибыль, рентабельность, топ товар)',
]:
    add_bullet(f)

doc.add_page_break()

# ============================================================
# 16. ВЗАИМОСВЯЗИ МЕЖДУ МОДУЛЯМИ
# ============================================================
add_heading('16. Взаимосвязи между модулями', level=1)

add_para('ПРОДАЖА влияет на:', bold=True)
for f in ['Склад (списание товара)', 'Финансы (приход денег, расчёт себестоимости)', 'Персонал (начисление зарплаты)', 'Клиенты (история покупок, бонусы)', 'Аналитика (обновление метрик)', 'Маркетинг (ROI канала, если клиент новый)']:
    add_bullet(f)

add_para('ПРИХОД ТОВАРА влияет на:', bold=True)
for f in ['Склад (создание партий, увеличение остатков)', 'Поставщики (цены, рейтинг, история)', 'Номенклатура (средняя цена закупа)', 'Финансы (кредиторская задолженность)', 'Аналитика (учёт в себестоимости)']:
    add_bullet(f)

add_para('ЗАКАЗ влияет на:', bold=True)
for f in ['Склад (резервирование)', 'Клиенты (обновление)', 'Доставка (задача курьеру)', 'Персонал (ответственный, курьер)', 'Финансы (предоплата)']:
    add_bullet(f)

add_para('КОМПЛЕКТАЦИЯ влияет на:', bold=True)
for f in ['Склад (списание компонентов, оприходование букета)', 'Номенклатура (создание букета)', 'Аналитика (расчёт себестоимости)']:
    add_bullet(f)

doc.add_page_break()

# ============================================================
# 17. РОЛИ И ПРАВА ДОСТУПА
# ============================================================
add_heading('17. Роли и права доступа', level=1)

add_para('Предустановленные роли:', bold=True)
roles = [
    ('Владелец', 'Полный доступ ко всем модулям и функциям без ограничений'),
    ('Администратор', 'Почти полный доступ: не может изменять роли и права, не видит детальную разбивку зарплат, ограничен в финансовых настройках'),
    ('Менеджер', 'Управление заказами, клиентами, складом, поставщиками. Нет доступа к: рентабельности, прибыли, зарплатам, закупочным ценам'),
    ('Продавец', 'Продажи и заказы, просмотр клиентов, просмотр остатков (без цен закупа), комплектация букетов. Нет доступа к: финансам, поставщикам, зарплатам'),
    ('Курьер', 'Только раздел «Доставка» — свои доставки, обновление статусов'),
    ('Бухгалтер', 'Полный доступ к финансам и аналитике. Нет доступа к: управлению складом, управлению сотрудниками'),
]
for role, desc in roles:
    add_para(f'{role}: {desc}')

add_para('Можно создать кастомную роль с точечной настройкой прав: Просмотр, Редактирование, Удаление, Проведение документов — для каждого модуля отдельно.')

add_para('Матрица прав доступа:', bold=True)
add_table_simple(
    ['Модуль / Функция', 'Владелец', 'Админ', 'Менеджер', 'Продавец', 'Курьер', 'Бухгалтер'],
    [
        ['Просмотр остатков', '✅', '✅', '✅', '✅ (без цен)', '❌', '✅ (только)'],
        ['Приход товара', '✅', '✅', '✅', '❌', '❌', '❌'],
        ['Комплектация', '✅', '✅', '✅', '✅', '❌', '❌'],
        ['Списание', '✅', '✅', '✅', '⚠️', '❌', '❌'],
        ['Инвентаризация', '✅', '✅', '✅', '❌', '❌', '✅ (просмотр)'],
        ['Продажи', '✅', '✅', '✅', '✅', '❌', '❌'],
        ['Все продажи', '✅', '✅', '✅', '⚠️ (свои)', '❌', '✅'],
        ['Возвраты', '✅', '✅', '✅', '⚠️', '❌', '✅'],
        ['Клиенты (просмотр)', '✅', '✅', '✅', '✅', '❌', '❌'],
        ['Поставщики', '✅', '✅', '✅', '❌', '❌', '✅'],
        ['Цены закупа', '✅', '✅', '✅', '❌', '❌', '✅'],
        ['Персонал', '✅', '✅', '⚠️', '❌', '❌', '✅'],
        ['Зарплаты', '✅', '⚠️ (общие итоги)', '❌', '❌', '❌', '✅'],
        ['Финансы (касса)', '✅', '✅', '⚠️ (остаток)', '⚠️ (остаток)', '❌', '✅'],
        ['Прибыль', '✅', '⚠️', '❌', '❌', '❌', '✅'],
        ['Аналитика', '✅', '✅', '⚠️', '⚠️ (свои)', '❌', '✅'],
        ['Маркетинг', '✅', '✅', '⚠️', '❌', '❌', '✅'],
        ['Бюджет рекламы', '✅', '⚠️', '❌', '❌', '❌', '✅'],
        ['Доставки', '✅', '✅', '✅', '✅', '⚠️ (свои)', '❌'],
        ['Настройки', '✅', '⚠️', '❌', '❌', '❌', '⚠️ (фин.)'],
        ['Роли и права', '✅', '❌', '❌', '❌', '❌', '❌'],
    ]
)
doc.add_paragraph()
add_para('✅ — полный доступ, ⚠️ — ограниченный (с оговорками), ❌ — нет доступа.')

doc.add_page_break()

# ============================================================
# 18. АВТОМАТИЗАЦИЯ
# ============================================================
add_heading('18. Автоматизация', level=1)

add_para('Автоматические процессы системы:', bold=True)
auto_processes = [
    ('Расчёт себестоимости', 'При продаже товар списывается по FIFO, рассчитывается себестоимость, фиксируется прибыль'),
    ('Начисление зарплаты', 'При продаже → процент продавцу. При закрытии смены → оплата за смену. Накапливается'),
    ('Обновление цен', 'При приходе товара обновляется последняя и средняя цена закупа'),
    ('Рейтинг поставщика', 'При каждом приходе пересчитывается рейтинг (качество, сроки, брак)'),
    ('Резервирование', 'При создании заказа с флагом «Резерв» — товар блокируется, создаётся код'),
    ('Закрытие резервов', 'При продаже — «Продан», при отмене — «Отменён», при истечении срока — «Просрочен»'),
    ('Периодические расходы', 'Система создаёт запланированные платежи по настроенной периодичности'),
    ('Уценка цветов', 'При достижении критического срока свежести — автоматическая уценка или перевод в «Требует списания»'),
    ('Пересчёт себестоимости шаблонов', 'При изменении цен компонентов — пересчёт плановой себестоимости шаблонов'),
    ('Бонусы лояльности', 'При продаже — начисление бонусов клиенту, при использовании — списание'),
]
for title, desc in auto_processes:
    add_para(f'{title}: {desc}')

doc.add_page_break()

# ============================================================
# 19. ДОПОЛНИТЕЛЬНЫЕ ВОЗМОЖНОСТИ
# ============================================================
add_heading('19. Дополнительные возможности', level=1)

add_heading('19.1. Фотофиксация', level=2)
add_para('Фото используется в: номенклатуре, шаблонах и индивидуальных букетах, браке при приёмке и списании, доставке (подпись получателя), клиентах и сотрудниках.')
add_para('Загрузка с устройства, съёмка через камеру (на мобильном), галерея, удаление.')

add_heading('19.2. Комментарии', level=2)
add_para('К заказам, клиентам, поставщикам, товарам, сотрудникам. Структура: дата-время, автор, текст. Редактирование/удаление — только автор или администратор.')

add_heading('19.3. История изменений (аудит)', level=2)
add_para('Ведётся для критичных операций: изменение цен, удаление/восстановление данных, изменение прав, отмена документов, редактирование финансов. Кто, когда, что изменил. Историю нельзя удалить (защита от мошенничества).')

add_heading('19.4. Экспорт данных', level=2)
add_para('Excel (XLSX): отчёты, остатки, списки, финансы. PDF: чеки, накладные, отчёты. CSV: для импорта в 1С и другие системы. Кнопка «Экспорт» на всех отчётах и таблицах.')

add_heading('19.5. Печать документов', level=2)
add_para('Чеки, накладные, заказы, маршрутные листы, акты инвентаризации, договоры, финансовые отчёты. Настраиваемые шаблоны (логотип, реквизиты). Форматы: A4, чековая лента.')

add_heading('19.6. Глобальный поиск', level=2)
add_para('Доступен из любого раздела. Поиск по: номенклатуре, клиентам, заказам, документам, поставщикам. Поддержка опечаток, поиск по части слова, подсказки.')

add_heading('19.7. Мобильная версия (PWA)', level=2)
add_para('Адаптивный интерфейс для смартфонов и планшетов. Упрощённые формы для быстрых операций. Сканирование штрих-кодов камерой. Push-уведомления. Работа курьеров через мобильное приложение.')

doc.add_page_break()

# ============================================================
# 20. ПРОГРАММА ЛОЯЛЬНОСТИ
# ============================================================
add_heading('20. Программа лояльности', level=1)

add_para('Назначение: удержание клиентов и стимулирование повторных покупок — критически важно для цветочного бизнеса.')

add_heading('20.1. Настройка', level=2)
add_para('В «Настройки → Программа лояльности» задаётся:')
for f in [
    'Включена / выключена',
    'Процент начисления бонусов (например, 5 % от суммы покупки)',
    'Курс списания (например, 1 бонус = 1 ₽)',
    'Максимальный процент оплаты бонусами (например, до 30 % от суммы чека)',
    'Срок действия бонусов (например, 12 месяцев с момента начисления)',
    'Приветственные бонусы (начисление при первой регистрации, например 200 бонусов)',
    'Уровни лояльности (опционально): Бронзовый (0–5000 ₽ покупок: 3 % бонусов), Серебряный (5001–20000: 5 %), Золотой (>20000: 7 %)',
]:
    add_bullet(f)

add_heading('20.2. Процесс', level=2)
add_para('При продаже с указанием клиента — бонусы начисляются автоматически. При следующей покупке — продавец видит баланс бонусов и предлагает списать. Списание уменьшает сумму к оплате.')

doc.add_page_break()

# ============================================================
# 21. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ
# ============================================================
add_heading('21. Технические требования', level=1)

add_heading('21.1. Производительность', level=2)
for f in [
    'Время отклика на действия пользователя < 1 секунды',
    'Поддержка одновременной работы 50+ пользователей',
    'Работа при объёме данных: до 1 000 000 записей движения товара',
]:
    add_bullet(f)

add_heading('21.2. Безопасность', level=2)
for f in [
    'Шифрование данных (TLS в транзите, AES для чувствительных данных)',
    'Регулярное резервное копирование (ежедневный full + PITR)',
    'Защита от несанкционированного доступа (JWT + 2FA)',
    'Логирование всех критичных операций (аудит)',
    'Изоляция данных клиентов (multi-tenancy)',
]:
    add_bullet(f)

add_heading('21.3. Масштабируемость', level=2)
for f in [
    'Модульная архитектура — возможность расширения функционала',
    'Горизонтальное масштабирование (добавление серверов)',
    'Поддержка нескольких торговых точек в рамках одного аккаунта',
]:
    add_bullet(f)

add_heading('21.4. Доступность', level=2)
for f in [
    'SLA: 99,5 % uptime',
    'Работа во всех современных браузерах (Chrome, Firefox, Safari, Edge)',
    'Мобильная версия (PWA) для iOS и Android',
]:
    add_bullet(f)

doc.add_page_break()

# ============================================================
# ЗАКЛЮЧЕНИЕ
# ============================================================
add_heading('Заключение', level=1)

add_para('FlowerBoss — комплексная SaaS-система для управления цветочным бизнесом, разработанная специально для индивидуальных цветочных магазинов и локальных сетей. Система охватывает:')

conclusions = [
    'Складской учёт с партионным FIFO-методом и автоматическим расчётом себестоимости',
    'Управление поставщиками с рейтингами, историей цен и претензиями',
    'CRM для работы с клиентами: знаменательные даты, история, бонусная программа',
    'Продажи и заказы с резервированием, предоплатами и доставкой',
    'Гибкая система оплаты труда с прогрессивными шкалами и потолками',
    'Многокошельковый финансовый учёт с прогнозированием кассовых разрывов',
    'Аналитика: P&L, ABC-анализ, ROI рекламы, прогнозирование, воронка конверсии',
    'Маркетинг: каналы, скидки, акции, промокоды',
    'Доставка с курьерами, маршрутными листами и статусами',
    'Программа лояльности с бонусами и уровнями',
    'Учёт личных средств сотрудников и гибкие кошельки',
]
for c in conclusions:
    add_bullet(c)

add_para('')
add_para('Система помогает владельцу цветочного магазина: всегда знать остатки и свежесть цветов, понимать реальную прибыль, не терять клиентов благодаря напоминаниям, оптимизировать расходы, видеть эффективность рекламы и управлять бизнесом с любого устройства.')

# ============================================================
# СОХРАНЕНИЕ
# ============================================================
output_path = r'd:\B2B\FLOW\FLOW_v2_исправленный.docx'
doc.save(output_path)
print(f'Документ сохранён: {output_path}')
