"""
Генератор инструкции пользователя FlowerBoss в формате Word (.docx)
"""
from docx import Document
from docx.shared import Pt, Cm, RGBColor, Inches
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.enum.table import WD_TABLE_ALIGNMENT, WD_ALIGN_VERTICAL
from docx.oxml.ns import qn
from docx.oxml import OxmlElement
import datetime

# ──────────────────────────────────────────────
# Вспомогательные функции стиля
# ──────────────────────────────────────────────

def set_run_color(run, r, g, b):
    run.font.color.rgb = RGBColor(r, g, b)

def add_heading(doc, text, level=1, color=(30, 30, 100)):
    p = doc.add_heading(text, level=level)
    p.alignment = WD_ALIGN_PARAGRAPH.LEFT
    for run in p.runs:
        run.font.color.rgb = RGBColor(*color)
    return p

def add_info_box(doc, label, content, box_color=(240, 248, 255)):
    """Добавляет выделенный блок-подсказку."""
    table = doc.add_table(rows=1, cols=1)
    table.alignment = WD_TABLE_ALIGNMENT.LEFT
    cell = table.cell(0, 0)
    # Цвет фона
    tcPr = cell._tc.get_or_add_tcPr()
    shd = OxmlElement('w:shd')
    shd.set(qn('w:val'), 'clear')
    shd.set(qn('w:color'), 'auto')
    hex_color = '%02X%02X%02X' % box_color
    shd.set(qn('w:fill'), hex_color)
    tcPr.append(shd)
    # Содержимое
    cell.text = ''
    p = cell.paragraphs[0]
    run = p.add_run(f'💡 {label}: ')
    run.bold = True
    run.font.size = Pt(10)
    run2 = p.add_run(content)
    run2.font.size = Pt(10)
    doc.add_paragraph()
    return table

def add_step_box(doc, steps):
    """Добавляет нумерованный список шагов."""
    for i, step in enumerate(steps, 1):
        p = doc.add_paragraph(style='List Number')
        run = p.add_run(step)
        run.font.size = Pt(10.5)

def add_warning(doc, text):
    """Красный предупреждающий блок."""
    table = doc.add_table(rows=1, cols=1)
    table.alignment = WD_TABLE_ALIGNMENT.LEFT
    cell = table.cell(0, 0)
    tcPr = cell._tc.get_or_add_tcPr()
    shd = OxmlElement('w:shd')
    shd.set(qn('w:val'), 'clear')
    shd.set(qn('w:color'), 'auto')
    shd.set(qn('w:fill'), 'FFF0F0')
    tcPr.append(shd)
    cell.text = ''
    p = cell.paragraphs[0]
    run = p.add_run('⚠️ Внимание: ')
    run.bold = True
    run.font.color.rgb = RGBColor(180, 0, 0)
    run.font.size = Pt(10)
    run2 = p.add_run(text)
    run2.font.size = Pt(10)
    doc.add_paragraph()

def add_feature_table(doc, headers, rows):
    """Добавляет таблицу возможностей."""
    table = doc.add_table(rows=1, cols=len(headers))
    table.style = 'Table Grid'
    hdr_cells = table.rows[0].cells
    for i, h in enumerate(headers):
        hdr_cells[i].text = h
        hdr_cells[i].paragraphs[0].runs[0].bold = True
        hdr_cells[i].paragraphs[0].runs[0].font.size = Pt(9.5)
        tcPr = hdr_cells[i]._tc.get_or_add_tcPr()
        shd = OxmlElement('w:shd')
        shd.set(qn('w:val'), 'clear')
        shd.set(qn('w:color'), 'auto')
        shd.set(qn('w:fill'), '1E1E64')
        tcPr.append(shd)
        hdr_cells[i].paragraphs[0].runs[0].font.color.rgb = RGBColor(255, 255, 255)
    for row_data in rows:
        row_cells = table.add_row().cells
        for i, val in enumerate(row_data):
            row_cells[i].text = val
            row_cells[i].paragraphs[0].runs[0].font.size = Pt(9.5)
    doc.add_paragraph()
    return table

# ──────────────────────────────────────────────
# Основной документ
# ──────────────────────────────────────────────

doc = Document()

# Поля страницы
from docx.oxml import OxmlElement
sections = doc.sections
for section in sections:
    section.top_margin = Cm(2)
    section.bottom_margin = Cm(2)
    section.left_margin = Cm(2.5)
    section.right_margin = Cm(2)

# Стиль абзаца по умолчанию
style = doc.styles['Normal']
style.font.name = 'Calibri'
style.font.size = Pt(11)

# ─── ТИТУЛЬНАЯ СТРАНИЦА ───────────────────────────────────────
p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('\n\n\n')

p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('🌸  FlowerBoss')
run.font.size = Pt(36)
run.font.bold = True
run.font.color.rgb = RGBColor(30, 30, 100)

p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('Система управления цветочным бизнесом')
run.font.size = Pt(18)
run.font.color.rgb = RGBColor(80, 80, 140)

doc.add_paragraph()
p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('РУКОВОДСТВО ПОЛЬЗОВАТЕЛЯ')
run.font.size = Pt(22)
run.font.bold = True
run.font.color.rgb = RGBColor(50, 50, 50)

doc.add_paragraph()
doc.add_paragraph()
p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run(f'Версия 1.0  •  {datetime.date.today().strftime("%d.%m.%Y")}')
run.font.size = Pt(12)
run.font.color.rgb = RGBColor(120, 120, 120)
run.font.italic = True

doc.add_page_break()

# ─── СОДЕРЖАНИЕ (вручную) ─────────────────────────────────────
add_heading(doc, 'СОДЕРЖАНИЕ', 1)

toc_items = [
    ('1.', 'Введение и назначение системы', '3'),
    ('2.', 'Начало работы — Вход в систему', '4'),
    ('3.', 'Интерфейс — Навигация и структура', '5'),
    ('4.', 'Дашборд — Главный экран', '6'),
    ('5.', 'Номенклатура — Каталог товаров', '7'),
    ('6.', 'Склад — Управление запасами', '9'),
    ('7.', 'Продажи — Оформление продаж', '12'),
    ('8.', 'Заказы — Управление заказами', '14'),
    ('9.', 'Клиенты — База клиентов', '17'),
    ('10.', 'Поставщики', '19'),
    ('11.', 'Персонал', '21'),
    ('12.', 'Финансы', '23'),
    ('13.', 'Маркетинг', '26'),
    ('14.', 'Доставка', '28'),
    ('15.', 'Аналитика', '29'),
    ('16.', 'Настройки организации', '31'),
    ('17.', 'Профиль пользователя', '32'),
    ('18.', 'Роли и права доступа', '33'),
    ('19.', 'Советы, горячие клавиши и FAQ', '34'),
]
toc_table = doc.add_table(rows=0, cols=3)
for num, title, page in toc_items:
    row = toc_table.add_row().cells
    row[0].text = num
    row[0].width = Cm(1)
    row[1].text = title
    row[2].text = page
    row[2].paragraphs[0].alignment = WD_ALIGN_PARAGRAPH.RIGHT
    for c in row:
        for para in c.paragraphs:
            for run in para.runs:
                run.font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 1 — ВВЕДЕНИЕ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '1. Введение и назначение системы', 1)

p = doc.add_paragraph(
    'FlowerBoss — это профессиональная облачная система управления цветочным бизнесом. '
    'Она объединяет в одном приложении все ключевые процессы: '
    'складской учёт, продажи, заказы, доставку, финансы, персонал, маркетинг и аналитику. '
    'Система работает в режиме SaaS (Software as a Service) — вы работаете через браузер, '
    'без установки программного обеспечения на компьютер.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Что умеет FlowerBoss', 2)

features = [
    ['Модуль', 'Что делает'],
    ['🌸 Номенклатура', 'Ведение каталога: цветы, букеты, горшечные растения, упаковка'],
    ['📦 Склад', 'Управление остатками, приём товара, списание, перемещение, сборка букетов'],
    ['🛒 Продажи', 'Оформление розничных продаж прямо на точке'],
    ['📋 Заказы', 'Приём и ведение предварительных заказов с доставкой'],
    ['👥 Клиенты', 'База клиентов, история покупок, сегментация'],
    ['🚚 Поставщики', 'Учёт поставщиков, заказы на закупку, претензии'],
    ['👨‍💼 Персонал', 'Сотрудники, должности, смены, зарплаты'],
    ['💰 Финансы', 'Кассы, транзакции, долги, движение денег'],
    ['📣 Маркетинг', 'Рекламные каналы, скидки, промокоды, программы лояльности'],
    ['🚗 Доставка', 'Курьеры, зоны доставки, статусы доставки'],
    ['📈 Аналитика', 'Ежедневная аналитика, графики, отчёты'],
    ['⚙️ Настройки', 'Торговые точки, склады, способы оплаты'],
]

table = doc.add_table(rows=1, cols=2)
table.style = 'Table Grid'
hdr = table.rows[0].cells
hdr[0].text = 'Модуль'
hdr[1].text = 'Что делает'
for c in hdr:
    c.paragraphs[0].runs[0].bold = True
    c.paragraphs[0].runs[0].font.color.rgb = RGBColor(255, 255, 255)
    tcPr = c._tc.get_or_add_tcPr()
    shd = OxmlElement('w:shd')
    shd.set(qn('w:val'), 'clear')
    shd.set(qn('w:color'), 'auto')
    shd.set(qn('w:fill'), '1E1E64')
    tcPr.append(shd)

for mod, desc in features[1:]:
    row = table.add_row().cells
    row[0].text = mod
    row[1].text = desc
    for c in row:
        c.paragraphs[0].runs[0].font.size = Pt(10)

doc.add_paragraph()
doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 2 — ВХОД В СИСТЕМУ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '2. Начало работы — Вход в систему', 1)

p = doc.add_paragraph(
    'Для доступа к FlowerBoss вам потребуются логин и пароль, которые предоставляет '
    'администратор вашей организации или администратор платформы.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Как войти в систему', 2)
add_step_box(doc, [
    'Откройте браузер (рекомендуется Google Chrome или Mozilla Firefox).',
    'В адресной строке введите адрес вашей системы (например: http://localhost:3000 или адрес, выданный администратором).',
    'Отобразится страница входа с полями «Логин» и «Пароль».',
    'Введите ваш логин (имя пользователя) в поле «Логин».',
    'Введите ваш пароль в поле «Пароль».',
    'Нажмите кнопку «Войти».',
    'При успешной авторизации вы будете перенаправлены на главный дашборд.',
])

add_info_box(doc,
    'Совет',
    'Если вы забыли пароль — обратитесь к владельцу или администратору вашей организации. '
    'Они могут сменить пароль в разделе «Персонал» → вкладка «Пользователи».',
    (240, 255, 240)
)

add_warning(doc,
    'Не передавайте свои логин и пароль другим лицам. '
    'Каждый сотрудник должен работать под своей учётной записью для корректного ведения журналов операций.'
)

add_heading(doc, 'Что делать при первом входе', 2)
p = doc.add_paragraph(
    'Если вы входите первым в новую организацию и торговые точки ещё не настроены, '
    'система покажет подсказку-онбординг (оранжевое предупреждение вверху). '
    'Вам необходимо перейти в раздел «Настройки» и создать хотя бы одну торговую точку и склад, '
    'прежде чем начать работу.'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 3 — ИНТЕРФЕЙС
# ──────────────────────────────────────────────────────────────
add_heading(doc, '3. Интерфейс — Навигация и структура', 1)

add_heading(doc, 'Боковое меню (Sidebar)', 2)
p = doc.add_paragraph(
    'После входа слева отображается боковая панель навигации. '
    'Она содержит все разделы системы. Меню можно свернуть, нажав на иконку-гамбургер '
    '(три горизонтальные полосы) в верхней части панели — при этом останутся только иконки разделов, '
    'что экономит место на экране.'
)
p.runs[0].font.size = Pt(11)

add_feature_table(doc,
    ['Иконка / Пункт меню', 'Раздел системы', 'Краткое описание'],
    [
        ['🏠', 'Дашборд', 'Главная страница с ключевыми показателями'],
        ['🌸', 'Номенклатура', 'Каталог товаров и услуг'],
        ['📦', 'Склад', 'Остатки, партии, движения товара'],
        ['🛒', 'Продажи', 'Розничные продажи'],
        ['📋', 'Заказы', 'Предварительные заказы'],
        ['👥', 'Клиенты', 'База покупателей'],
        ['🏪', 'Поставщики', 'Поставщики и закупки'],
        ['👨‍💼', 'Персонал', 'Сотрудники и смены'],
        ['💰', 'Финансы', 'Деньги и транзакции'],
        ['📣', 'Маркетинг', 'Скидки, акции, реклама'],
        ['🚗', 'Доставка', 'Курьеры и доставки'],
        ['📈', 'Аналитика', 'Отчёты и графики'],
        ['⚙️', 'Настройки', 'Конфигурация организации'],
    ]
)

add_heading(doc, 'Верхняя панель (AppBar)', 2)
p = doc.add_paragraph(
    'В верхней части экрана расположена горизонтальная панель. Справа находится аватар пользователя — '
    'нажав на него, вы откроете меню с пунктами «Профиль», «Настройки» и «Выйти».'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Принцип работы таблиц', 2)
p = doc.add_paragraph(
    'Большинство разделов отображают данные в виде таблиц. Все таблицы поддерживают: '
    'постраничную навигацию (до 25 записей на страницу), поиск по ключевым полям, '
    'фильтрацию по статусу и другим параметрам, кнопки редактирования (карандаш) и удаления (корзина) '
    'для каждой строки, кнопку «Добавить» в верхней части для создания новой записи.'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 4 — ДАШБОРД
# ──────────────────────────────────────────────────────────────
add_heading(doc, '4. Дашборд — Главный экран', 1)

p = doc.add_paragraph(
    'Дашборд — это первая страница, которую вы видите после входа. '
    'Он даёт быстрый обзор состояния бизнеса.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Блоки KPI (ключевые показатели)', 2)
add_feature_table(doc,
    ['Показатель', 'Описание'],
    [
        ['Выручка сегодня', 'Сумма завершённых продаж за текущий день'],
        ['Продаж сегодня', 'Количество завершённых продаж за сегодня'],
        ['Выручка за месяц', 'Сумма всех завершённых продаж с начала текущего месяца'],
        ['Активных заказов', 'Количество заказов в статусах: новый, подтверждён, в сборке, собран, в доставке'],
        ['Клиентов', 'Общее количество клиентов в базе'],
        ['Баланс касс', 'Суммарный остаток по всем активным кошелькам/кассам'],
    ]
)

add_heading(doc, 'Графики', 2)
p = doc.add_paragraph(
    'Ниже KPI-карточек расположено два графика за последние 7 дней:\n'
    '• График «Выручка / Прибыль» — столбчатая диаграмма ежедневной выручки (синие столбцы) '
    'и прибыли (зелёные столбцы).\n'
    '• График «Продажи и заказы» — линейный график количества продаж и заказов по дням.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Таблицы быстрого доступа', 2)
p = doc.add_paragraph(
    'В нижней части дашборда расположены две важные таблицы:\n'
    '• «Новые заказы» — последние 5 заказов в статусе «Новый», требующих обработки.\n'
    '• «Низкий остаток» — список позиций, у которых остаток на складе ниже критического уровня. '
    'Эти позиции требуют срочного пополнения запасов.'
)
p.runs[0].font.size = Pt(11)

add_info_box(doc,
    'Совет',
    'Посещайте дашборд в начале каждого рабочего дня, чтобы быстро оценить ситуацию и '
    'запланировать приоритеты: обработать новые заказы и заказать недостающий товар.',
    (240, 248, 255)
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 5 — НОМЕНКЛАТУРА
# ──────────────────────────────────────────────────────────────
add_heading(doc, '5. Номенклатура — Каталог товаров', 1)

p = doc.add_paragraph(
    'Номенклатура — это ваш каталог всех товаров и услуг. Здесь хранится информация о каждой позиции: '
    'название, цены, тип, единица измерения и другие характеристики. '
    'Без правильно заполненной номенклатуры невозможно вести склад, продажи и заказы.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела', 2)
add_feature_table(doc,
    ['Вкладка', 'Описание'],
    [
        ['Номенклатура', 'Основной список всех товарных позиций'],
        ['Группы', 'Иерархические категории для структурирования каталога'],
        ['Единицы измерения', 'Шт., кг, л, м и т.д.'],
        ['Шаблоны букетов', 'Рецептуры букетов с перечнем компонентов'],
    ]
)

add_heading(doc, 'Типы номенклатуры', 2)
add_feature_table(doc,
    ['Тип', 'Описание'],
    [
        ['Штучный цветок (single_flower)', 'Отдельный цветок — роза, тюльпан и т.д.'],
        ['Букет (bouquet)', 'Готовый букет, может иметь шаблон состава'],
        ['Композиция (composition)', 'Цветочная композиция'],
        ['Горшечное растение (potted)', 'Растения в горшках'],
        ['Упаковка (packaging)', 'Коробки, плёнка, лента и т.д.'],
        ['Сопутствующий товар (related)', 'Открытки, игрушки, шоколад и т.д.'],
        ['Зелень (greenery)', 'Декоративная зелень'],
        ['Услуга (service)', 'Флористические услуги, мастер-классы'],
        ['Набор (set)', 'Сборные наборы из нескольких позиций'],
    ]
)

add_heading(doc, 'Как добавить новую позицию', 2)
add_step_box(doc, [
    'Перейдите в раздел «Номенклатура».',
    'Нажмите кнопку «+ Добавить» в правом верхнем углу таблицы.',
    'В открывшемся диалоге заполните: Название (обязательно), Тип, Группу, Единицу измерения.',
    'Укажите цены: Розничная цена — цена продажи клиенту; Закупочная цена — входящая цена от поставщика.',
    'При необходимости заполните дополнительные поля: сезон, срок хранения, минимальный остаток.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Шаблоны букетов', 2)
p = doc.add_paragraph(
    'Шаблон букета — это рецептура, которая определяет, из каких позиций состоит букет и в каком количестве. '
    'Шаблоны используются при сборке букетов на складе (автоматическое списание компонентов).'
)
p.runs[0].font.size = Pt(11)

add_step_box(doc, [
    'Перейдите на вкладку «Шаблоны букетов».',
    'Нажмите «+ Добавить».',
    'Выберите позицию номенклатуры с типом «Букет».',
    'Добавьте компоненты: для каждого компонента укажите позицию и количество.',
    'Нажмите «Сохранить».',
])

add_info_box(doc,
    'Важно',
    'Перед добавлением шаблона убедитесь, что все компоненты (цветы, упаковка) уже внесены в номенклатуру.',
    (255, 250, 230)
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 6 — СКЛАД
# ──────────────────────────────────────────────────────────────
add_heading(doc, '6. Склад — Управление запасами', 1)

p = doc.add_paragraph(
    'Раздел «Склад» — сердце учёта товарных запасов. Система использует метод FIFO '
    '(First In — First Out, «первым пришёл — первым ушёл»), что особенно важно '
    'для скоропортящихся товаров, таких как срезанные цветы.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела Склад', 2)
add_feature_table(doc,
    ['Вкладка', 'Что показывает'],
    [
        ['Остатки', 'Текущий остаток по каждой позиции в каждом складе'],
        ['Партии', 'Все партии товара с датами поступления и сроками хранения'],
        ['Движения', 'История всех складских операций (приход, списание, перемещение и т.д.)'],
    ]
)

add_heading(doc, 'Приём товара (Партии → Добавить)', 2)
p = doc.add_paragraph(
    'Приём товара создаёт новую партию и автоматически увеличивает остаток на складе. '
    'При этом сохраняется история: когда поступил товар, от какого поставщика, по какой цене.'
)
p.runs[0].font.size = Pt(11)

add_step_box(doc, [
    'Перейдите на вкладку «Партии».',
    'Нажмите «+ Добавить».',
    'Выберите номенклатуру (позицию товара).',
    'Выберите склад, на который принимается товар.',
    'Укажите поставщика (необязательно, но рекомендуется).',
    'Введите количество и закупочную цену.',
    'Укажите дату прихода и дату истечения срока хранения (очень важно для цветов!).',
    'При наличии — номер накладной.',
    'Нажмите «Сохранить». Остаток на складе обновится автоматически.',
])

add_heading(doc, 'Списание товара', 2)
p = doc.add_paragraph(
    'Списание применяется, когда товар испорчен, потерян или списывается по другой причине '
    '(не продан и не перемещён).'
)
p.runs[0].font.size = Pt(11)

add_step_box(doc, [
    'Перейдите на вкладку «Движения».',
    'Нажмите кнопку «Списание» (красная иконка с крестом).',
    'Выберите склад, номенклатуру и введите количество.',
    'Выберите причину списания: «Истёк срок», «Повреждение», «Потеря», «Дефект», «Другое».',
    'Нажмите «Списать».',
])

add_heading(doc, 'Перемещение между складами', 2)
add_step_box(doc, [
    'Нажмите кнопку «Перемещение» (иконка со стрелками).',
    'Укажите склад-источник и склад-назначение.',
    'Выберите номенклатуру и введите количество.',
    'Нажмите «Переместить».',
])

add_heading(doc, 'Сборка букета', 2)
p = doc.add_paragraph(
    'Сборка букета — это специальная операция, которая автоматически списывает компоненты '
    'букета (по шаблону или вручную) и добавляет готовый букет на склад.'
)
p.runs[0].font.size = Pt(11)

add_step_box(doc, [
    'Нажмите кнопку «Сборка» (иконка со звёздочкой).',
    'Выберите номенклатуру с типом «Букет».',
    'Укажите склад, откуда берутся компоненты, и склад, на который помещается готовый букет.',
    'Введите количество букетов для сборки.',
    'Если у букета есть шаблон — включите «Использовать шаблон», и компоненты подтянутся автоматически.',
    'Нажмите «Собрать».',
])

add_warning(doc,
    'Перед сборкой убедитесь, что на складе достаточно компонентов. '
    'Если компонентов не хватает, система выдаст ошибку «Недостаточно товара».'
)

add_heading(doc, 'Раскомплектовка букета', 2)
p = doc.add_paragraph(
    'При необходимости разобрать уже собранный букет обратно на компоненты — используйте '
    'функцию раскомплектовки. Часть компонентов можно вернуть на склад, часть — списать.'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 7 — ПРОДАЖИ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '7. Продажи — Оформление продаж', 1)

p = doc.add_paragraph(
    'Раздел «Продажи» используется для розничных продаж: клиент пришёл в магазин, '
    'выбрал товар, оплатил. Продажи — это быстрые операции «здесь и сейчас», '
    'в отличие от Заказов (предварительный заказ с доставкой).'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Статусы продажи', 2)
add_feature_table(doc,
    ['Статус', 'Описание'],
    [
        ['Открыта', 'Продажа в процессе оформления, ещё не завершена'],
        ['Завершена', 'Оплачена и закрыта, товар списан со склада'],
        ['Отменена', 'Продажа отменена'],
    ]
)

add_heading(doc, 'Как создать новую продажу', 2)
add_step_box(doc, [
    'Перейдите в раздел «Продажи».',
    'Нажмите «+ Новая продажа».',
    'Выберите торговую точку.',
    'При необходимости — прикрепите клиента из базы или оставьте анонимно.',
    'Выберите способ оплаты.',
    'Добавьте позиции: нажмите «+ Добавить позицию», выберите номенклатуру, укажите количество.',
    'При необходимости — установите скидку в процентах для конкретной позиции.',
    'Проверьте итоговую сумму.',
    'Нажмите «Сохранить».',
    'Для завершения продажи — откройте её и смените статус на «Завершена» или установите флаг «Оплачена».',
])

add_heading(doc, 'Скидки', 2)
p = doc.add_paragraph(
    'Скидку можно установить на каждую позицию отдельно (в поле «Скидка %»). '
    'Система автоматически пересчитает итоговую сумму строки и общий итог продажи. '
    'Если у вас настроены активные акции в разделе «Маркетинг», скидка по акции применяется '
    'при указании промокода в заказе.'
)
p.runs[0].font.size = Pt(11)

add_info_box(doc,
    'Важно',
    'При завершении продажи товар автоматически списывается со склада методом FIFO '
    '(сначала списываются самые старые партии). Отменить это действие вручную нельзя — '
    'только через создание возврата.',
    (255, 250, 230)
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 8 — ЗАКАЗЫ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '8. Заказы — Управление заказами', 1)

p = doc.add_paragraph(
    'Заказы — это предварительные заказы от клиентов, которые требуют подготовки и, '
    'как правило, доставки. Заказ проходит через несколько этапов от создания до завершения.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Жизненный цикл заказа', 2)

lifecycle = [
    ['Новый', 'Заказ только создан, ждёт подтверждения'],
    ['Подтверждён', 'Заказ принят сотрудником'],
    ['В сборке', 'Флорист собирает букет'],
    ['Собран', 'Букет готов, ждёт курьера'],
    ['В доставке', 'Курьер забрал и везёт'],
    ['Доставлен', 'Курьер доставил клиенту'],
    ['Завершён', 'Оплата получена, заказ закрыт'],
    ['Отменён', 'Заказ отменён'],
]
add_feature_table(doc,
    ['Статус', 'Описание'],
    lifecycle
)

add_heading(doc, 'Как создать заказ', 2)
add_step_box(doc, [
    'Перейдите в раздел «Заказы».',
    'Нажмите «+ Новый заказ».',
    'Выберите источник заказа: Магазин, Телефон, Сайт, Instagram, Telegram, WhatsApp, Другое.',
    'Укажите торговую точку.',
    'При необходимости — прикрепите клиента из базы или включите режим «Анонимный заказ».',
    'Заполните данные получателя: ФИО, телефон, адрес доставки.',
    'Введите желаемую дату и время доставки.',
    'Добавьте позиции заказа (аналогично продаже).',
    'Укажите стоимость доставки, предоплату.',
    'При наличии — введите промокод.',
    'Добавьте текст открытки (если требуется).',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Назначение ответственных', 2)
p = doc.add_paragraph(
    'В каждом заказе можно назначить:\n'
    '• Ответственного сотрудника (менеджер, принявший заказ)\n'
    '• Флориста (кто собирает букет)\n'
    '• Курьера (кто доставляет)\n'
    'Эти поля заполняются из списка сотрудников, зарегистрированных в разделе «Персонал».'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Смена статуса заказа', 2)
add_step_box(doc, [
    'Найдите заказ в таблице.',
    'Нажмите на иконку редактирования (карандаш).',
    'Измените поле «Статус» на нужный.',
    'При необходимости — добавьте комментарий к смене статуса.',
    'Нажмите «Сохранить».',
])

add_info_box(doc,
    'История статусов',
    'Все смены статуса заказа фиксируются в истории с датой и временем. '
    'Её можно посмотреть на вкладке «История» при просмотре/редактировании заказа.',
    (240, 248, 255)
)

add_heading(doc, 'Фильтры заказов', 2)
p = doc.add_paragraph(
    'Над таблицей заказов расположены фильтры:\n'
    '• Поиск — по номеру заказа, имени клиента, получателя\n'
    '• Статус — фильтр по текущему статусу\n'
    '• Источник — фильтр по каналу поступления заказа\n'
    'Работайте с ними, чтобы быстро находить нужные заказы.'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 9 — КЛИЕНТЫ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '9. Клиенты — База клиентов', 1)

p = doc.add_paragraph(
    'Раздел «Клиенты» содержит базу данных всех ваших покупателей. '
    'Ведение клиентской базы позволяет персонализировать обслуживание, '
    'анализировать покупательскую активность и проводить маркетинговые рассылки.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Информация о клиенте', 2)
add_feature_table(doc,
    ['Поле', 'Описание'],
    [
        ['ФИО', 'Фамилия, имя, отчество клиента'],
        ['Телефон', 'Основной контактный номер'],
        ['Email', 'Электронная почта'],
        ['Дата рождения', 'Для поздравлений и специальных предложений'],
        ['Сегмент', 'Категория клиента: новый, постоянный, VIP, оптовый'],
        ['Скидка %', 'Персональная скидка клиента'],
        ['Источник', 'Откуда узнал о нас: сарафанное радио, соцсети, объявление и т.д.'],
        ['Реферал', 'Кто порекомендовал клиента'],
        ['Согласие на рассылку', 'Разрешение на маркетинговые сообщения'],
    ]
)

add_heading(doc, 'Как добавить клиента', 2)
add_step_box(doc, [
    'Перейдите в раздел «Клиенты».',
    'Нажмите «+ Добавить».',
    'Заполните минимальные обязательные поля: имя и телефон.',
    'При наличии — заполните остальные поля.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Сегменты клиентов', 2)
add_feature_table(doc,
    ['Сегмент', 'Кто это'],
    [
        ['Новый (new)', 'Клиент, совершивший 1-2 покупки'],
        ['Постоянный (regular)', 'Регулярно покупающий клиент'],
        ['VIP (vip)', 'Особо ценный клиент с высоким чеком или частотой покупок'],
        ['Оптовый (wholesale)', 'Корпоративный или оптовый покупатель'],
    ]
)

p = doc.add_paragraph(
    'Сегмент можно задать вручную при создании или редактировании клиента. '
    'Используйте сегменты для персонализированных предложений и особого обслуживания.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'История покупок', 2)
p = doc.add_paragraph(
    'При просмотре карточки клиента (кнопка редактирования) доступна полная история '
    'его заказов и продаж. Это помогает вспомнить предпочтения клиента при следующем обращении.'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 10 — ПОСТАВЩИКИ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '10. Поставщики', 1)

p = doc.add_paragraph(
    'Раздел «Поставщики» позволяет вести учёт партнёров, от которых вы закупаете товар, '
    'создавать заказы поставщику и фиксировать претензии по качеству.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела', 2)
add_feature_table(doc,
    ['Вкладка', 'Описание'],
    [
        ['Поставщики', 'Список поставщиков с контактными данными'],
        ['Товары поставщиков', 'Каталог товаров, которые предлагает конкретный поставщик, с ценами'],
        ['Заказы поставщикам', 'История заказов на закупку'],
        ['Претензии', 'Фиксация проблем с качеством поставок'],
    ]
)

add_heading(doc, 'Добавление поставщика', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Поставщики».',
    'Нажмите «+ Добавить».',
    'Заполните: название, контактное лицо, телефон, email, адрес.',
    'При наличии — укажите ИНН, условия оплаты (количество дней отсрочки), рейтинг.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Заказ поставщику', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Заказы поставщикам».',
    'Нажмите «+ Добавить».',
    'Выберите поставщика и ожидаемую дату доставки.',
    'Добавьте позиции заказа: выберите номенклатуру, укажите количество и цену.',
    'Нажмите «Сохранить» — заказ получит статус «Черновик».',
    'Для отправки заказа поставщику — смените статус на «Отправлен».',
    'После получения товара — смените статус на «Получен» и создайте партии на складе.',
])

add_heading(doc, 'Претензии к поставщику', 2)
p = doc.add_paragraph(
    'Если полученный товар не соответствует качеству — зафиксируйте претензию. '
    'Это помогает отслеживать надёжность поставщиков и требовать компенсацию.'
)
p.runs[0].font.size = Pt(11)

add_step_box(doc, [
    'Перейдите на вкладку «Претензии».',
    'Нажмите «+ Добавить».',
    'Выберите поставщика и конкретную партию (если известна).',
    'Введите описание проблемы и сумму претензии.',
    'Нажмите «Сохранить».',
])

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 11 — ПЕРСОНАЛ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '11. Персонал', 1)

p = doc.add_paragraph(
    'Раздел «Персонал» предназначен для управления сотрудниками: '
    'их регистрации, составления расписания смен и расчёта заработной платы.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела', 2)
add_feature_table(doc,
    ['Вкладка', 'Описание'],
    [
        ['Сотрудники', 'Список всех сотрудников с контактами и должностью'],
        ['Должности', 'Справочник должностей с базовой ставкой оклада'],
        ['Смены', 'Расписание рабочих смен по дням'],
        ['Зарплата', 'Начисления и выплаты заработной платы'],
    ]
)

add_heading(doc, 'Добавление сотрудника', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Сотрудники».',
    'Нажмите «+ Добавить».',
    'Заполните: ФИО, телефон, email, должность, торговую точку, дату приёма.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Планирование смен', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Смены».',
    'Нажмите «+ Добавить».',
    'Выберите сотрудника, торговую точку, дату смены.',
    'Укажите время начала и окончания смены.',
    'При необходимости — укажите перерыв в минутах.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Начисление зарплаты', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Зарплата».',
    'Нажмите «+ Начислить».',
    'Выберите сотрудника и укажите период (дата начала и конца).',
    'Введите базовую сумму, бонус (при наличии) и штраф (при наличии).',
    'Нажмите «Сохранить» — начисление получит статус «Ожидает».',
    'Для одобрения — смените статус на «Одобрена».',
    'После выплаты — смените статус на «Выплачена» и выберите кассу/кошелёк, из которого выплачено.',
])

add_info_box(doc,
    'Связь с финансами',
    'При выплате зарплаты (статус «Выплачена») система автоматически создаёт транзакцию '
    'типа «Зарплата» в разделе Финансы и списывает сумму с указанного кошелька.',
    (240, 248, 255)
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 12 — ФИНАНСЫ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '12. Финансы', 1)

p = doc.add_paragraph(
    'Раздел «Финансы» — полный финансовый учёт вашего бизнеса: '
    'кассы и счета, все денежные операции, долги и обязательства.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела', 2)
add_feature_table(doc,
    ['Вкладка', 'Описание'],
    [
        ['Кошельки', 'Кассы, банковские счета, карты и электронные кошельки'],
        ['Транзакции', 'История всех финансовых операций'],
        ['Категории', 'Статьи доходов и расходов'],
        ['Долги', 'Дебиторская и кредиторская задолженность'],
    ]
)

add_heading(doc, 'Кошельки и кассы', 2)
p = doc.add_paragraph(
    'Кошелёк в системе — это любой «карман», где хранятся деньги бизнеса. '
    'Создайте кошелёк для каждой наличной кассы, расчётного счёта и карты.'
)
p.runs[0].font.size = Pt(11)

add_feature_table(doc,
    ['Тип кошелька', 'Назначение'],
    [
        ['Касса (cash)', 'Наличные деньги в торговой точке'],
        ['Расчётный счёт (bank_account)', 'Банковский счёт организации'],
        ['Банковская карта (card)', 'Корпоративная карта'],
        ['Личная карта (personal_card)', 'Личная карта сотрудника для рабочих расходов'],
        ['Онлайн-кошелёк (online)', 'ЮKassa, Сбер, Tinkoff Pay и т.д.'],
        ['Прочее (other)', 'Любой другой источник'],
    ]
)

add_heading(doc, 'Как добавить кошелёк', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Кошельки».',
    'Нажмите «+ Добавить».',
    'Введите название, выберите тип.',
    'При необходимости — привяжите к торговой точке.',
    'Установите начальный баланс (если деньги уже есть).',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Типы транзакций', 2)
add_feature_table(doc,
    ['Тип', 'Когда используется'],
    [
        ['Доход (income)', 'Поступление денег (не от продажи). Например, возврат от поставщика.'],
        ['Расход (expense)', 'Любой расход. Например, оплата аренды, хоз. нужды.'],
        ['Перевод (transfer)', 'Перемещение денег между своими кошельками'],
        ['Зарплата (salary)', 'Выплата зарплаты сотруднику'],
        ['Личные расходы (personal_expense)', 'Личные расходы сотрудника за счёт компании'],
        ['Оплата поставщику (supplier_payment)', 'Платёж за товар поставщику'],
    ]
)

add_heading(doc, 'Создание транзакции', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Транзакции».',
    'Нажмите «+ Добавить».',
    'Выберите тип транзакции.',
    'Выберите кошелёк-источник (откуда уходят деньги) и/или кошелёк-назначение (куда приходят).',
    'Введите сумму.',
    'Выберите категорию (статью ДДС) — это важно для аналитики.',
    'Добавьте описание.',
    'Нажмите «Сохранить». Баланс кошелька обновится автоматически.',
])

add_heading(doc, 'Долги', 2)
p = doc.add_paragraph(
    'В разделе «Долги» ведётся учёт задолженностей:\n'
    '• «Мы должны» (we_owe) — ваша задолженность перед поставщиком или сотрудником.\n'
    '• «Нам должны» (owed_to_us) — задолженность клиента или другого лица перед вами.\n'
    'При частичной оплате долга вы можете указать оплаченную сумму. '
    'Когда долг погашен полностью — отметьте его как «Закрыт».'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 13 — МАРКЕТИНГ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '13. Маркетинг', 1)

p = doc.add_paragraph(
    'Раздел «Маркетинг» объединяет инструменты для привлечения и удержания клиентов: '
    'рекламные каналы, скидки, промокоды и программы лояльности.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела', 2)
add_feature_table(doc,
    ['Вкладка', 'Описание'],
    [
        ['Рекламные каналы', 'Источники рекламы (Instagram, Яндекс, флаеры и т.д.)'],
        ['Инвестиции в рекламу', 'Затраты на каждый рекламный канал по периодам'],
        ['Скидки', 'Акции и скидочные предложения'],
        ['Промокоды', 'Кодовые слова для получения скидки'],
        ['Программы лояльности', 'Накопительные и бонусные программы'],
    ]
)

add_heading(doc, 'Рекламные каналы и ROI', 2)
p = doc.add_paragraph(
    'Добавьте все ваши рекламные каналы (Instagram, ВКонтакте, Яндекс.Директ, листовки и т.д.) '
    'и фиксируйте ежемесячные затраты на каждый. '
    'В разделе Аналитика система покажет, какой канал приносит больший доход.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Создание скидки / акции', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Скидки».',
    'Нажмите «+ Добавить».',
    'Введите название акции.',
    'Выберите тип скидки: процент (%) или фиксированная сумма (₽).',
    'Укажите размер скидки.',
    'Установите даты начала и окончания акции.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Создание промокода', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Промокоды».',
    'Нажмите «+ Добавить».',
    'Введите кодовое слово (например: ROSE10).',
    'Укажите тип и размер скидки по промокоду.',
    'Установите срок действия и максимальное количество использований.',
    'Нажмите «Сохранить».',
    'При оформлении заказа введите промокод в соответствующее поле.',
])

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 14 — ДОСТАВКА
# ──────────────────────────────────────────────────────────────
add_heading(doc, '14. Доставка', 1)

p = doc.add_paragraph(
    'Раздел «Доставка» управляет логистикой: зонами доставки, курьерами и отслеживанием доставок.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Вкладки раздела', 2)
add_feature_table(doc,
    ['Вкладка', 'Описание'],
    [
        ['Зоны доставки', 'Географические зоны с указанием стоимости и времени доставки'],
        ['Курьеры', 'База курьеров (штатные и внешние)'],
        ['Доставки', 'Список доставок с привязкой к заказам'],
    ]
)

add_heading(doc, 'Настройка зон доставки', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Зоны доставки».',
    'Нажмите «+ Добавить».',
    'Введите название зоны (например: Центр, Правый берег).',
    'Укажите стоимость доставки в эту зону.',
    'Укажите ориентировочное время доставки (в минутах).',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Добавление курьера', 2)
add_step_box(doc, [
    'Перейдите на вкладку «Курьеры».',
    'Нажмите «+ Добавить».',
    'Введите имя курьера, телефон.',
    'Выберите тип: Штатный, Внешний или Сервис (служба доставки).',
    'При наличии — привяжите к сотруднику в системе.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Статусы доставки', 2)
add_feature_table(doc,
    ['Статус', 'Описание'],
    [
        ['Ожидает (pending)', 'Доставка создана, курьер ещё не назначен или не выехал'],
        ['Доставлено (delivered)', 'Товар успешно доставлен клиенту'],
        ['Не доставлено (failed)', 'Доставка не состоялась (клиент не открыл дверь, неверный адрес)'],
        ['Отменено (cancelled)', 'Доставка отменена'],
    ]
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 15 — АНАЛИТИКА
# ──────────────────────────────────────────────────────────────
add_heading(doc, '15. Аналитика', 1)

p = doc.add_paragraph(
    'Раздел «Аналитика» предоставляет данные для принятия управленческих решений. '
    'Здесь собрана ежедневная статистика по ключевым показателям бизнеса.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Ежедневные сводки', 2)
p = doc.add_paragraph(
    'В таблице отображаются данные по каждому дню:\n'
)
p.runs[0].font.size = Pt(11)

add_feature_table(doc,
    ['Показатель', 'Описание'],
    [
        ['Дата', 'Отчётный день'],
        ['Торговая точка', 'Точка, по которой сформирована сводка'],
        ['Выручка', 'Сумма завершённых продаж за день'],
        ['Себестоимость', 'Закупочная стоимость проданных товаров'],
        ['Прибыль', 'Выручка минус себестоимость'],
        ['Продаж', 'Количество завершённых продаж'],
        ['Заказов', 'Количество заказов за день'],
        ['Средний чек', 'Средняя сумма одной продажи/заказа'],
        ['Новых клиентов', 'Количество первых покупок'],
        ['Списаний', 'Сумма списанного товара'],
    ]
)

add_heading(doc, 'Как читать аналитику', 2)
p = doc.add_paragraph(
    'Регулярно (желательно ежедневно) просматривайте показатели за предыдущий день. '
    'Обращайте особое внимание на:\n'
    '• Рост/падение выручки и прибыли — тренды по неделям и месяцам\n'
    '• Средний чек — если он падает, возможно, стоит пересмотреть ценообразование или ввести upsell\n'
    '• Количество новых клиентов — эффективность рекламных каналов\n'
    '• Сумма списаний — если высокая, нужно пересмотреть объём закупок'
)
p.runs[0].font.size = Pt(11)

add_info_box(doc,
    'Обновление данных',
    'Ежедневные сводки формируются автоматически на основе завершённых продаж и заказов. '
    'Данные актуальны в режиме реального времени.',
    (240, 248, 255)
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 16 — НАСТРОЙКИ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '16. Настройки организации', 1)

p = doc.add_paragraph(
    'Раздел «Настройки» позволяет настроить базовую инфраструктуру вашей организации: '
    'торговые точки, склады и способы оплаты. Без корректной настройки этих элементов '
    'остальные разделы работать не будут.'
)
p.runs[0].font.size = Pt(11)

add_heading(doc, 'Торговые точки', 2)
p = doc.add_paragraph(
    'Торговая точка — это физическое место ведения бизнеса (магазин, стойка, точка выдачи). '
    'Создайте отдельную запись для каждой точки.'
)
p.runs[0].font.size = Pt(11)
add_step_box(doc, [
    'Перейдите в «Настройки» → вкладка «Торговые точки».',
    'Нажмите «+ Добавить».',
    'Введите название и адрес точки.',
    'При наличии — номер телефона и режим работы.',
    'Назначьте руководителя точки из списка сотрудников.',
    'Нажмите «Сохранить».',
])

add_heading(doc, 'Склады', 2)
p = doc.add_paragraph(
    'Каждая торговая точка может иметь несколько складов разного типа.'
)
p.runs[0].font.size = Pt(11)
add_feature_table(doc,
    ['Тип склада', 'Назначение'],
    [
        ['Основной (main)', 'Основное хранилище товара'],
        ['Витрина (showcase)', 'Товар на витрине в зоне продажи'],
        ['Холодильник (fridge)', 'Хранение срезанных цветов'],
        ['Зона комплектации (assembly)', 'Рабочее место флориста для сборки'],
        ['Резервный (reserve)', 'Резервное хранилище'],
    ]
)

add_heading(doc, 'Способы оплаты', 2)
p = doc.add_paragraph(
    'Добавьте все принимаемые способы оплаты: наличные, безналичные, '
    'перевод на карту, QR-код и т.д. Они будут доступны при оформлении продаж и заказов.'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 17 — ПРОФИЛЬ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '17. Профиль пользователя', 1)

p = doc.add_paragraph(
    'Каждый пользователь может управлять своим профилем: изменить личные данные и сменить пароль.'
)
p.runs[0].font.size = Pt(11)

add_step_box(doc, [
    'Нажмите на аватар в правом верхнем углу.',
    'Выберите пункт «Профиль».',
    'На странице профиля вы можете изменить: имя, отчество, телефон, email, загрузить фото.',
    'Для смены пароля нажмите «Сменить пароль», введите старый и новый пароль (минимум 8 символов).',
    'Нажмите «Сохранить».',
])

add_warning(doc,
    'После смены пароля вам не нужно повторно входить в систему — '
    'сессия сохраняется. Но следующий вход будет уже с новым паролем.'
)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 18 — РОЛИ И ПРАВА
# ──────────────────────────────────────────────────────────────
add_heading(doc, '18. Роли и права доступа', 1)

p = doc.add_paragraph(
    'Система поддерживает ролевую модель доступа. '
    'Каждый пользователь имеет одну роль, которая определяет, что он может делать.'
)
p.runs[0].font.size = Pt(11)

add_feature_table(doc,
    ['Роль', 'Кто это', 'Уровень доступа'],
    [
        ['Владелец (owner)', 'Собственник бизнеса', 'Полный доступ ко всем разделам'],
        ['Администратор (admin)', 'Управляющий', 'Полный доступ ко всем разделам'],
        ['Менеджер (manager)', 'Старший продавец, менеджер', 'Запись и чтение во всех разделах кроме некоторых настроек'],
        ['Продавец (seller)', 'Кассир, продавец', 'Продажи, заказы, клиенты — запись; остальное — чтение'],
        ['Курьер (courier)', 'Доставщик', 'Только чтение (доставки и заказы)'],
        ['Бухгалтер (accountant)', 'Финансовый специалист', 'Финансы — полный доступ; остальное — чтение'],
    ]
)

add_heading(doc, 'Управление пользователями', 2)
p = doc.add_paragraph(
    'Владелец и администратор организации могут добавлять новых пользователей через раздел «Персонал». '
    'Каждому новому пользователю назначается логин, пароль и роль. '
    'Лимит пользователей зависит от вашего тарифного плана '
    '(по умолчанию — 5 пользователей на организацию).'
)
p.runs[0].font.size = Pt(11)

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# РАЗДЕЛ 19 — СОВЕТЫ И FAQ
# ──────────────────────────────────────────────────────────────
add_heading(doc, '19. Советы, рекомендации и часто задаваемые вопросы', 1)

add_heading(doc, 'Рекомендуемый порядок первоначальной настройки', 2)
p = doc.add_paragraph(
    'Если вы только начинаете работать с FlowerBoss, выполните следующие шаги по порядку:'
)
p.runs[0].font.size = Pt(11)
add_step_box(doc, [
    'Настройки → Добавьте торговые точки.',
    'Настройки → Добавьте склады для каждой точки.',
    'Настройки → Добавьте способы оплаты.',
    'Номенклатура → Создайте группы и единицы измерения.',
    'Номенклатура → Добавьте товарные позиции с ценами.',
    'Номенклатура → Создайте шаблоны букетов (если продаёте готовые букеты).',
    'Поставщики → Добавьте основных поставщиков.',
    'Склад → Оприходуйте начальные остатки (добавьте партии).',
    'Персонал → Добавьте должности и сотрудников.',
    'Финансы → Создайте кошельки (кассы) и внесите начальные остатки.',
    'Всё готово — начинайте работу!',
])

add_heading(doc, 'Ежедневный чек-лист', 2)
add_step_box(doc, [
    'Проверить дашборд — выручка вчера, активные заказы, низкий остаток.',
    'Обработать новые заказы — подтвердить, назначить флориста и курьера.',
    'Проверить остатки на складе — при необходимости создать заказ поставщику.',
    'В конце дня — закрыть открытые продажи и проверить баланс кассы.',
])

add_heading(doc, 'Часто задаваемые вопросы', 2)

faq = [
    (
        'В: Я не вижу нужный склад при создании партии. Что делать?',
        'О: Склады создаются в разделе Настройки → Склады. Убедитесь, что склад создан '
        'и что он активен (флаг «Активен»).'
    ),
    (
        'В: Клиент хочет вернуть товар. Как оформить возврат?',
        'О: В текущей версии возврат оформляется как новое поступление на склад (Партии → Добавить) '
        'с пометкой в комментарии «Возврат от клиента», и одновременно создаётся транзакция '
        'типа Расход на сумму возврата.'
    ),
    (
        'В: Почему нельзя удалить торговую точку?',
        'О: Если торговая точка имеет связанные данные (сотрудники, склады, продажи), '
        'удаление заблокировано для сохранения целостности данных. '
        'Вместо удаления — деактивируйте точку (снимите флаг «Активна»).'
    ),
    (
        'В: Как пополнить баланс кассы без продажи?',
        'О: Создайте транзакцию типа «Доход» (Финансы → Транзакции → + Добавить), '
        'укажите кошелёк-назначение и сумму.'
    ),
    (
        'В: Можно ли работать на нескольких устройствах одновременно?',
        'О: Да, система работает в браузере и поддерживает одновременную работу с нескольких '
        'устройств под одним аккаунтом.'
    ),
    (
        'В: Как экспортировать данные в Excel?',
        'О: Функция экспорта будет добавлена в следующих версиях. '
        'Пока данные можно скопировать из таблицы или обратиться к администратору платформы.'
    ),
    (
        'В: Как добавить нового пользователя в систему?',
        'О: Зайдите в Персонал → вкладка «Пользователи» (доступно для ролей Владелец/Администратор). '
        'Нажмите «+ Добавить», заполните данные. '
        'Не забудьте установить надёжный пароль и передать его сотруднику.'
    ),
    (
        'В: Где посмотреть историю действий (кто что делал)?',
        'О: История транзакций, продаж и заказов содержит поля «Автор» и «Дата». '
        'Подробный журнал всех событий — в разработке.'
    ),
]

for q, a in faq:
    p = doc.add_paragraph()
    run = p.add_run(q)
    run.bold = True
    run.font.size = Pt(10.5)
    run.font.color.rgb = RGBColor(30, 30, 100)
    p2 = doc.add_paragraph()
    run2 = p2.add_run(a)
    run2.font.size = Pt(10.5)
    run2.font.color.rgb = RGBColor(60, 60, 60)
    doc.add_paragraph()

doc.add_page_break()

# ──────────────────────────────────────────────────────────────
# ФИНАЛЬНАЯ СТРАНИЦА
# ──────────────────────────────────────────────────────────────
p = doc.add_paragraph('\n\n\n')
p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('🌸  FlowerBoss')
run.font.size = Pt(28)
run.font.bold = True
run.font.color.rgb = RGBColor(30, 30, 100)

p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('Спасибо, что доверяете нам управление вашим бизнесом!')
run.font.size = Pt(14)
run.font.color.rgb = RGBColor(80, 80, 140)
run.font.italic = True

doc.add_paragraph()
p = doc.add_paragraph()
p.alignment = WD_ALIGN_PARAGRAPH.CENTER
run = p.add_run('По вопросам работы системы обращайтесь к администратору платформы.')
run.font.size = Pt(11)
run.font.color.rgb = RGBColor(100, 100, 100)

# ──────────────────────────────────────────────────────────────
# СОХРАНЕНИЕ
# ──────────────────────────────────────────────────────────────
output_path = r'D:\B2B\FLOW\FlowerBoss_Руководство_Пользователя.docx'
doc.save(output_path)
print(f'Документ сохранён: {output_path}')
